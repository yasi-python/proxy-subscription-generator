"use strict";exports.__esModule=!0,exports.default=void 0,exports.unescapeValue=unescapeValue;var _CSSESC_QUOTE_OPTIONS,_cssesc=_interopRequireDefault(require("cssesc")),_unesc=_interopRequireDefault(require("../util/unesc")),_namespace=_interopRequireDefault(require("./namespace")),_types=require("./types");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}var deprecate=require("util-deprecate"),WRAPPED_IN_QUOTES=/^('|")([^]*)\1$/,warnOfDeprecatedValueAssignment=deprecate(function(){},"Assigning an attribute a value containing characters that might need to be escaped is deprecated. Call attribute.setValue() instead."),warnOfDeprecatedQuotedAssignment=deprecate(function(){},"Assigning attr.quoted is deprecated and has no effect. Assign to attr.quoteMark instead."),warnOfDeprecatedConstructor=deprecate(function(){},"Constructing an Attribute selector with a value without specifying quoteMark is deprecated. Note: The value should be unescaped now.");function unescapeValue(e){var t=!1,r=null,a=e,i=a.match(WRAPPED_IN_QUOTES);return i&&(r=i[1],a=i[2]),(a=(0,_unesc.default)(a))!==e&&(t=!0),{deprecatedUsage:t,unescaped:a,quoteMark:r}}function handleDeprecatedContructorOpts(e){if(void 0!==e.quoteMark)return e;if(void 0===e.value)return e;warnOfDeprecatedConstructor();var t=unescapeValue(e.value),r=t.quoteMark,a=t.unescaped;return e.raws||(e.raws={}),void 0===e.raws.value&&(e.raws.value=e.value),e.value=a,e.quoteMark=r,e}var Attribute=function(e){function t(t){var r;return void 0===t&&(t={}),(r=e.call(this,handleDeprecatedContructorOpts(t))||this).type=_types.ATTRIBUTE,r.raws=r.raws||{},Object.defineProperty(r.raws,"unquoted",{get:deprecate(function(){return r.value},"attr.raws.unquoted is deprecated. Call attr.value instead."),set:deprecate(function(){return r.value},"Setting attr.raws.unquoted is deprecated and has no effect. attr.value is unescaped by default now.")}),r._constructed=!0,r}_inheritsLoose(t,e);var r=t.prototype;return r.getQuotedValue=function(e){void 0===e&&(e={});var t=this._determineQuoteMark(e),r=CSSESC_QUOTE_OPTIONS[t];return(0,_cssesc.default)(this._value,r)},r._determineQuoteMark=function(e){return e.smart?this.smartQuoteMark(e):this.preferredQuoteMark(e)},r.setValue=function(e,t){void 0===t&&(t={}),this._value=e,this._quoteMark=this._determineQuoteMark(t),this._syncRawValue()},r.smartQuoteMark=function(e){var r=this.value,a=r.replace(/[^']/g,"").length,i=r.replace(/[^"]/g,"").length;if(a+i===0){var s=(0,_cssesc.default)(r,{isIdentifier:!0});if(s===r)return t.NO_QUOTE;var n=this.preferredQuoteMark(e);if(n===t.NO_QUOTE){var u=this.quoteMark||e.quoteMark||t.DOUBLE_QUOTE,o=CSSESC_QUOTE_OPTIONS[u];if((0,_cssesc.default)(r,o).length<s.length)return u}return n}return i===a?this.preferredQuoteMark(e):i<a?t.DOUBLE_QUOTE:t.SINGLE_QUOTE},r.preferredQuoteMark=function(e){var r=e.preferCurrentQuoteMark?this.quoteMark:e.quoteMark;return void 0===r&&(r=e.preferCurrentQuoteMark?e.quoteMark:this.quoteMark),void 0===r&&(r=t.DOUBLE_QUOTE),r},r._syncRawValue=function(){var e=(0,_cssesc.default)(this._value,CSSESC_QUOTE_OPTIONS[this.quoteMark]);e===this._value?this.raws&&delete this.raws.value:this.raws.value=e},r._handleEscapes=function(e,t){if(this._constructed){var r=(0,_cssesc.default)(t,{isIdentifier:!0});r!==t?this.raws[e]=r:delete this.raws[e]}},r._spacesFor=function(e){var t=this.spaces[e]||{},r=this.raws.spaces&&this.raws.spaces[e]||{};return Object.assign({before:"",after:""},t,r)},r._stringFor=function(e,t,r){void 0===t&&(t=e),void 0===r&&(r=defaultAttrConcat);var a=this._spacesFor(t);return r(this.stringifyProperty(e),a)},r.offsetOf=function(e){var t=1,r=this._spacesFor("attribute");if(t+=r.before.length,"namespace"===e||"ns"===e)return this.namespace?t:-1;if("attributeNS"===e)return t;if(t+=this.namespaceString.length,this.namespace&&(t+=1),"attribute"===e)return t;t+=this.stringifyProperty("attribute").length,t+=r.after.length;var a=this._spacesFor("operator");t+=a.before.length;var i=this.stringifyProperty("operator");if("operator"===e)return i?t:-1;t+=i.length,t+=a.after.length;var s=this._spacesFor("value");t+=s.before.length;var n=this.stringifyProperty("value");return"value"===e?n?t:-1:(t+=n.length,t+=s.after.length,t+=this._spacesFor("insensitive").before.length,"insensitive"===e&&this.insensitive?t:-1)},r.toString=function(){var e=this,t=[this.rawSpaceBefore,"["];return t.push(this._stringFor("qualifiedAttribute","attribute")),this.operator&&(this.value||""===this.value)&&(t.push(this._stringFor("operator")),t.push(this._stringFor("value")),t.push(this._stringFor("insensitiveFlag","insensitive",function(t,r){return!(t.length>0)||e.quoted||0!==r.before.length||e.spaces.value&&e.spaces.value.after||(r.before=" "),defaultAttrConcat(t,r)}))),t.push("]"),t.push(this.rawSpaceAfter),t.join("")},_createClass(t,[{key:"quoted",get:function(){var e=this.quoteMark;return"'"===e||'"'===e},set:function(e){warnOfDeprecatedQuotedAssignment()}},{key:"quoteMark",get:function(){return this._quoteMark},set:function(e){this._constructed?this._quoteMark!==e&&(this._quoteMark=e,this._syncRawValue()):this._quoteMark=e}},{key:"qualifiedAttribute",get:function(){return this.qualifiedName(this.raws.attribute||this.attribute)}},{key:"insensitiveFlag",get:function(){return this.insensitive?"i":""}},{key:"value",get:function(){return this._value},set:function(e){if(this._constructed){var t=unescapeValue(e),r=t.deprecatedUsage,a=t.unescaped,i=t.quoteMark;if(r&&warnOfDeprecatedValueAssignment(),a===this._value&&i===this._quoteMark)return;this._value=a,this._quoteMark=i,this._syncRawValue()}else this._value=e}},{key:"insensitive",get:function(){return this._insensitive},set:function(e){e||(this._insensitive=!1,!this.raws||"I"!==this.raws.insensitiveFlag&&"i"!==this.raws.insensitiveFlag||(this.raws.insensitiveFlag=void 0)),this._insensitive=e}},{key:"attribute",get:function(){return this._attribute},set:function(e){this._handleEscapes("attribute",e),this._attribute=e}}]),t}(_namespace.default);exports.default=Attribute,Attribute.NO_QUOTE=null,Attribute.SINGLE_QUOTE="'",Attribute.DOUBLE_QUOTE='"';var CSSESC_QUOTE_OPTIONS=((_CSSESC_QUOTE_OPTIONS={"'":{quotes:"single",wrap:!0},'"':{quotes:"double",wrap:!0}}).null={isIdentifier:!0},_CSSESC_QUOTE_OPTIONS);function defaultAttrConcat(e,t){return""+t.before+e+t.after}