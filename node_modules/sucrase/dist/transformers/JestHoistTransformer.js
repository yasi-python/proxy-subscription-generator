"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _optionalChain(e){let t,s=e[0],o=1;for(;o<e.length;){const n=e[o],r=e[o+1];if(o+=2,("optionalAccess"===n||"optionalCall"===n)&&null==s)return;"access"===n||"optionalAccess"===n?(t=s,s=r(s)):"call"!==n&&"optionalCall"!==n||(s=r((...e)=>s.call(t,...e)),t=void 0)}return s}Object.defineProperty(exports,"__esModule",{value:!0});var _types=require("../parser/tokenizer/types"),_Transformer=require("./Transformer"),_Transformer2=_interopRequireDefault(_Transformer);const JEST_GLOBAL_NAME="jest",HOISTED_METHODS=["mock","unmock","enableAutomock","disableAutomock"];class JestHoistTransformer extends _Transformer2.default{__init(){this.hoistedFunctionNames=[]}constructor(e,t,s,o){super(),this.rootTransformer=e,this.tokens=t,this.nameManager=s,this.importProcessor=o,JestHoistTransformer.prototype.__init.call(this)}process(){return!(0!==this.tokens.currentToken().scopeDepth||!this.tokens.matches4(_types.TokenType.name,_types.TokenType.dot,_types.TokenType.name,_types.TokenType.parenL)||"jest"!==this.tokens.identifierName())&&!_optionalChain([this,"access",e=>e.importProcessor,"optionalAccess",e=>e.getGlobalNames,"call",e=>e(),"optionalAccess",e=>e.has,"call",e=>e("jest")])&&this.extractHoistedCalls()}getHoistedCode(){return this.hoistedFunctionNames.length>0?this.hoistedFunctionNames.map(e=>`${e}();`).join(""):""}extractHoistedCalls(){this.tokens.removeToken();let e=!1;for(;this.tokens.matches3(_types.TokenType.dot,_types.TokenType.name,_types.TokenType.parenL);){const t=this.tokens.identifierNameAtIndex(this.tokens.currentIndex()+1);if(HOISTED_METHODS.includes(t)){const t=this.nameManager.claimFreeName("__jestHoist");this.hoistedFunctionNames.push(t),this.tokens.replaceToken(`function ${t}(){jest.`),this.tokens.copyToken(),this.tokens.copyToken(),this.rootTransformer.processBalancedCode(),this.tokens.copyExpectedToken(_types.TokenType.parenR),this.tokens.appendCode(";}"),e=!1}else e?this.tokens.copyToken():this.tokens.replaceToken("jest."),this.tokens.copyToken(),this.tokens.copyToken(),this.rootTransformer.processBalancedCode(),this.tokens.copyExpectedToken(_types.TokenType.parenR),e=!0}return!0}}exports.default=JestHoistTransformer;