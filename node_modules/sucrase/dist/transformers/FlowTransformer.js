"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _keywords=require("../parser/tokenizer/keywords"),_types=require("../parser/tokenizer/types"),_Transformer=require("./Transformer"),_Transformer2=_interopRequireDefault(_Transformer);class FlowTransformer extends _Transformer2.default{constructor(e,s,t){super(),this.rootTransformer=e,this.tokens=s,this.isImportsTransformEnabled=t}process(){return!(!(this.rootTransformer.processPossibleArrowParamEnd()||this.rootTransformer.processPossibleAsyncArrowWithTypeParams()||this.rootTransformer.processPossibleTypeRange())&&(this.tokens.matches1(_types.TokenType._enum)?(this.processEnum(),0):this.tokens.matches2(_types.TokenType._export,_types.TokenType._enum)?(this.processNamedExportEnum(),0):!this.tokens.matches3(_types.TokenType._export,_types.TokenType._default,_types.TokenType._enum)||(this.processDefaultExportEnum(),0)))}processNamedExportEnum(){if(this.isImportsTransformEnabled){this.tokens.removeInitialToken();const e=this.tokens.identifierNameAtRelativeIndex(1);this.processEnum(),this.tokens.appendCode(` exports.${e} = ${e};`)}else this.tokens.copyToken(),this.processEnum()}processDefaultExportEnum(){this.tokens.removeInitialToken(),this.tokens.removeToken();const e=this.tokens.identifierNameAtRelativeIndex(1);this.processEnum(),this.isImportsTransformEnabled?this.tokens.appendCode(` exports.default = ${e};`):this.tokens.appendCode(` export default ${e};`)}processEnum(){this.tokens.replaceToken("const"),this.tokens.copyExpectedToken(_types.TokenType.name);let e=!1;this.tokens.matchesContextual(_keywords.ContextualKeyword._of)&&(this.tokens.removeToken(),e=this.tokens.matchesContextual(_keywords.ContextualKeyword._symbol),this.tokens.removeToken());const s=this.tokens.matches3(_types.TokenType.braceL,_types.TokenType.name,_types.TokenType.eq);this.tokens.appendCode(' = require("flow-enums-runtime")');const t=!e&&!s;for(this.tokens.replaceTokenTrimmingLeftWhitespace(t?".Mirrored([":"({");!this.tokens.matches1(_types.TokenType.braceR);){if(this.tokens.matches1(_types.TokenType.ellipsis)){this.tokens.removeToken();break}this.processEnumElement(e,s),this.tokens.matches1(_types.TokenType.comma)&&this.tokens.copyToken()}this.tokens.replaceToken(t?"]);":"});")}processEnumElement(e,s){if(e){const e=this.tokens.identifierName();this.tokens.copyToken(),this.tokens.appendCode(`: Symbol("${e}")`)}else s?(this.tokens.copyToken(),this.tokens.replaceTokenTrimmingLeftWhitespace(":"),this.tokens.copyToken()):this.tokens.replaceToken(`"${this.tokens.identifierName()}"`)}}exports.default=FlowTransformer;