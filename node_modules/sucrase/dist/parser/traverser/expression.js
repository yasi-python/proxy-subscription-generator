"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _flow=require("../plugins/flow"),_index=require("../plugins/jsx/index"),_types=require("../plugins/types"),_typescript=require("../plugins/typescript"),_index3=require("../tokenizer/index"),_keywords=require("../tokenizer/keywords"),_state=require("../tokenizer/state"),_types3=require("../tokenizer/types"),_charcodes=require("../util/charcodes"),_identifier=require("../util/identifier"),_base=require("./base"),_lval=require("./lval"),_statement=require("./statement"),_util=require("./util");class StopState{constructor(e){this.stop=e}}function parseExpression(e=!1){if(parseMaybeAssign(e),_index3.match.call(void 0,_types3.TokenType.comma))for(;_index3.eat.call(void 0,_types3.TokenType.comma);)parseMaybeAssign(e)}function parseMaybeAssign(e=!1,t=!1){return _base.isTypeScriptEnabled?_typescript.tsParseMaybeAssign.call(void 0,e,t):_base.isFlowEnabled?_flow.flowParseMaybeAssign.call(void 0,e,t):baseParseMaybeAssign(e,t)}function baseParseMaybeAssign(e,t){if(_index3.match.call(void 0,_types3.TokenType._yield))return parseYield(),!1;(_index3.match.call(void 0,_types3.TokenType.parenL)||_index3.match.call(void 0,_types3.TokenType.name)||_index3.match.call(void 0,_types3.TokenType._yield))&&(_base.state.potentialArrowAt=_base.state.start);const s=parseMaybeConditional(e);return t&&parseParenItem(),_base.state.type&_types3.TokenType.IS_ASSIGN?(_index3.next.call(void 0),parseMaybeAssign(e),!1):s}function parseMaybeConditional(e){return!!parseExprOps(e)||(parseConditional(e),!1)}function parseConditional(e){_base.isTypeScriptEnabled||_base.isFlowEnabled?_types.typedParseConditional.call(void 0,e):baseParseConditional(e)}function baseParseConditional(e){_index3.eat.call(void 0,_types3.TokenType.question)&&(parseMaybeAssign(),_util.expect.call(void 0,_types3.TokenType.colon),parseMaybeAssign(e))}function parseExprOps(e){const t=_base.state.tokens.length;return!!parseMaybeUnary()||(parseExprOp(t,-1,e),!1)}function parseExprOp(e,t,s){if(_base.isTypeScriptEnabled&&(_types3.TokenType._in&_types3.TokenType.PRECEDENCE_MASK)>t&&!_util.hasPrecedingLineBreak.call(void 0)&&(_util.eatContextual.call(void 0,_keywords.ContextualKeyword._as)||_util.eatContextual.call(void 0,_keywords.ContextualKeyword._satisfies))){const a=_index3.pushTypeContext.call(void 0,1);return _typescript.tsParseType.call(void 0),_index3.popTypeContext.call(void 0,a),_index3.rescan_gt.call(void 0),void parseExprOp(e,t,s)}const a=_base.state.type&_types3.TokenType.PRECEDENCE_MASK;if(a>0&&(!s||!_index3.match.call(void 0,_types3.TokenType._in))&&a>t){const n=_base.state.type;_index3.next.call(void 0),n===_types3.TokenType.nullishCoalescing&&(_base.state.tokens[_base.state.tokens.length-1].nullishStartIndex=e);const o=_base.state.tokens.length;parseMaybeUnary(),parseExprOp(o,n&_types3.TokenType.IS_RIGHT_ASSOCIATIVE?a-1:a,s),n===_types3.TokenType.nullishCoalescing&&(_base.state.tokens[e].numNullishCoalesceStarts++,_base.state.tokens[_base.state.tokens.length-1].numNullishCoalesceEnds++),parseExprOp(e,t,s)}}function parseMaybeUnary(){if(_base.isTypeScriptEnabled&&!_base.isJSXEnabled&&_index3.eat.call(void 0,_types3.TokenType.lessThan))return _typescript.tsParseTypeAssertion.call(void 0),!1;if(_util.isContextual.call(void 0,_keywords.ContextualKeyword._module)&&_index3.lookaheadCharCode.call(void 0)===_charcodes.charCodes.leftCurlyBrace&&!_util.hasFollowingLineBreak.call(void 0))return parseModuleExpression(),!1;if(_base.state.type&_types3.TokenType.IS_PREFIX)return _index3.next.call(void 0),parseMaybeUnary(),!1;if(parseExprSubscripts())return!0;for(;_base.state.type&_types3.TokenType.IS_POSTFIX&&!_util.canInsertSemicolon.call(void 0);)_base.state.type===_types3.TokenType.preIncDec&&(_base.state.type=_types3.TokenType.postIncDec),_index3.next.call(void 0);return!1}function parseExprSubscripts(){const e=_base.state.tokens.length;return!!parseExprAtom()||(parseSubscripts(e),_base.state.tokens.length>e&&_base.state.tokens[e].isOptionalChainStart&&(_base.state.tokens[_base.state.tokens.length-1].isOptionalChainEnd=!0),!1)}function parseSubscripts(e,t=!1){_base.isFlowEnabled?_flow.flowParseSubscripts.call(void 0,e,t):baseParseSubscripts(e,t)}function baseParseSubscripts(e,t=!1){const s=new StopState(!1);do{parseSubscript(e,t,s)}while(!s.stop&&!_base.state.error)}function parseSubscript(e,t,s){_base.isTypeScriptEnabled?_typescript.tsParseSubscript.call(void 0,e,t,s):_base.isFlowEnabled?_flow.flowParseSubscript.call(void 0,e,t,s):baseParseSubscript(e,t,s)}function baseParseSubscript(e,t,s){if(!t&&_index3.eat.call(void 0,_types3.TokenType.doubleColon))parseNoCallExpr(),s.stop=!0,parseSubscripts(e,t);else if(_index3.match.call(void 0,_types3.TokenType.questionDot)){if(_base.state.tokens[e].isOptionalChainStart=!0,t&&_index3.lookaheadType.call(void 0)===_types3.TokenType.parenL)return void(s.stop=!0);_index3.next.call(void 0),_base.state.tokens[_base.state.tokens.length-1].subscriptStartIndex=e,_index3.eat.call(void 0,_types3.TokenType.bracketL)?(parseExpression(),_util.expect.call(void 0,_types3.TokenType.bracketR)):_index3.eat.call(void 0,_types3.TokenType.parenL)?parseCallExpressionArguments():parseMaybePrivateName()}else if(_index3.eat.call(void 0,_types3.TokenType.dot))_base.state.tokens[_base.state.tokens.length-1].subscriptStartIndex=e,parseMaybePrivateName();else if(_index3.eat.call(void 0,_types3.TokenType.bracketL))_base.state.tokens[_base.state.tokens.length-1].subscriptStartIndex=e,parseExpression(),_util.expect.call(void 0,_types3.TokenType.bracketR);else if(!t&&_index3.match.call(void 0,_types3.TokenType.parenL))if(atPossibleAsync()){const t=_base.state.snapshot(),a=_base.state.tokens.length;_index3.next.call(void 0),_base.state.tokens[_base.state.tokens.length-1].subscriptStartIndex=e;const n=_base.getNextContextId.call(void 0);_base.state.tokens[_base.state.tokens.length-1].contextId=n,parseCallExpressionArguments(),_base.state.tokens[_base.state.tokens.length-1].contextId=n,shouldParseAsyncArrow()&&(_base.state.restoreFromSnapshot(t),s.stop=!0,_base.state.scopeDepth++,_statement.parseFunctionParams.call(void 0),parseAsyncArrowFromCallExpression(a))}else{_index3.next.call(void 0),_base.state.tokens[_base.state.tokens.length-1].subscriptStartIndex=e;const t=_base.getNextContextId.call(void 0);_base.state.tokens[_base.state.tokens.length-1].contextId=t,parseCallExpressionArguments(),_base.state.tokens[_base.state.tokens.length-1].contextId=t}else _index3.match.call(void 0,_types3.TokenType.backQuote)?parseTemplate():s.stop=!0}function atPossibleAsync(){return _base.state.tokens[_base.state.tokens.length-1].contextualKeyword===_keywords.ContextualKeyword._async&&!_util.canInsertSemicolon.call(void 0)}function parseCallExpressionArguments(){let e=!0;for(;!_index3.eat.call(void 0,_types3.TokenType.parenR)&&!_base.state.error;){if(e)e=!1;else if(_util.expect.call(void 0,_types3.TokenType.comma),_index3.eat.call(void 0,_types3.TokenType.parenR))break;parseExprListItem(!1)}}function shouldParseAsyncArrow(){return _index3.match.call(void 0,_types3.TokenType.colon)||_index3.match.call(void 0,_types3.TokenType.arrow)}function parseAsyncArrowFromCallExpression(e){_base.isTypeScriptEnabled?_typescript.tsStartParseAsyncArrowFromCallExpression.call(void 0):_base.isFlowEnabled&&_flow.flowStartParseAsyncArrowFromCallExpression.call(void 0),_util.expect.call(void 0,_types3.TokenType.arrow),parseArrowExpression(e)}function parseNoCallExpr(){const e=_base.state.tokens.length;parseExprAtom(),parseSubscripts(e,!0)}function parseExprAtom(){if(_index3.eat.call(void 0,_types3.TokenType.modulo))return parseIdentifier(),!1;if(_index3.match.call(void 0,_types3.TokenType.jsxText)||_index3.match.call(void 0,_types3.TokenType.jsxEmptyText))return parseLiteral(),!1;if(_index3.match.call(void 0,_types3.TokenType.lessThan)&&_base.isJSXEnabled)return _base.state.type=_types3.TokenType.jsxTagStart,_index.jsxParseElement.call(void 0),_index3.next.call(void 0),!1;const e=_base.state.potentialArrowAt===_base.state.start;switch(_base.state.type){case _types3.TokenType.slash:case _types3.TokenType.assign:_index3.retokenizeSlashAsRegex.call(void 0);case _types3.TokenType._super:case _types3.TokenType._this:case _types3.TokenType.regexp:case _types3.TokenType.num:case _types3.TokenType.bigint:case _types3.TokenType.decimal:case _types3.TokenType.string:case _types3.TokenType._null:case _types3.TokenType._true:case _types3.TokenType._false:return _index3.next.call(void 0),!1;case _types3.TokenType._import:return _index3.next.call(void 0),_index3.match.call(void 0,_types3.TokenType.dot)&&(_base.state.tokens[_base.state.tokens.length-1].type=_types3.TokenType.name,_index3.next.call(void 0),parseIdentifier()),!1;case _types3.TokenType.name:{const t=_base.state.tokens.length,s=_base.state.start,a=_base.state.contextualKeyword;return parseIdentifier(),a===_keywords.ContextualKeyword._await?(parseAwait(),!1):a===_keywords.ContextualKeyword._async&&_index3.match.call(void 0,_types3.TokenType._function)&&!_util.canInsertSemicolon.call(void 0)?(_index3.next.call(void 0),_statement.parseFunction.call(void 0,s,!1),!1):e&&a===_keywords.ContextualKeyword._async&&!_util.canInsertSemicolon.call(void 0)&&_index3.match.call(void 0,_types3.TokenType.name)?(_base.state.scopeDepth++,_lval.parseBindingIdentifier.call(void 0,!1),_util.expect.call(void 0,_types3.TokenType.arrow),parseArrowExpression(t),!0):_index3.match.call(void 0,_types3.TokenType._do)&&!_util.canInsertSemicolon.call(void 0)?(_index3.next.call(void 0),_statement.parseBlock.call(void 0),!1):e&&!_util.canInsertSemicolon.call(void 0)&&_index3.match.call(void 0,_types3.TokenType.arrow)?(_base.state.scopeDepth++,_lval.markPriorBindingIdentifier.call(void 0,!1),_util.expect.call(void 0,_types3.TokenType.arrow),parseArrowExpression(t),!0):(_base.state.tokens[_base.state.tokens.length-1].identifierRole=_index3.IdentifierRole.Access,!1)}case _types3.TokenType._do:return _index3.next.call(void 0),_statement.parseBlock.call(void 0),!1;case _types3.TokenType.parenL:return parseParenAndDistinguishExpression(e);case _types3.TokenType.bracketL:return _index3.next.call(void 0),parseExprList(_types3.TokenType.bracketR,!0),!1;case _types3.TokenType.braceL:return parseObj(!1,!1),!1;case _types3.TokenType._function:return parseFunctionExpression(),!1;case _types3.TokenType.at:_statement.parseDecorators.call(void 0);case _types3.TokenType._class:return _statement.parseClass.call(void 0,!1),!1;case _types3.TokenType._new:return parseNew(),!1;case _types3.TokenType.backQuote:return parseTemplate(),!1;case _types3.TokenType.doubleColon:return _index3.next.call(void 0),parseNoCallExpr(),!1;case _types3.TokenType.hash:{const e=_index3.lookaheadCharCode.call(void 0);return _identifier.IS_IDENTIFIER_START[e]||e===_charcodes.charCodes.backslash?parseMaybePrivateName():_index3.next.call(void 0),!1}default:return _util.unexpected.call(void 0),!1}}function parseMaybePrivateName(){_index3.eat.call(void 0,_types3.TokenType.hash),parseIdentifier()}function parseFunctionExpression(){const e=_base.state.start;parseIdentifier(),_index3.eat.call(void 0,_types3.TokenType.dot)&&parseIdentifier(),_statement.parseFunction.call(void 0,e,!1)}function parseLiteral(){_index3.next.call(void 0)}function parseParenExpression(){_util.expect.call(void 0,_types3.TokenType.parenL),parseExpression(),_util.expect.call(void 0,_types3.TokenType.parenR)}function parseParenAndDistinguishExpression(e){const t=_base.state.snapshot(),s=_base.state.tokens.length;_util.expect.call(void 0,_types3.TokenType.parenL);let a=!0;for(;!_index3.match.call(void 0,_types3.TokenType.parenR)&&!_base.state.error;){if(a)a=!1;else if(_util.expect.call(void 0,_types3.TokenType.comma),_index3.match.call(void 0,_types3.TokenType.parenR))break;if(_index3.match.call(void 0,_types3.TokenType.ellipsis)){_lval.parseRest.call(void 0,!1),parseParenItem();break}parseMaybeAssign(!1,!0)}return _util.expect.call(void 0,_types3.TokenType.parenR),!!(e&&shouldParseArrow()&&parseArrow())&&(_base.state.restoreFromSnapshot(t),_base.state.scopeDepth++,_statement.parseFunctionParams.call(void 0),parseArrow(),parseArrowExpression(s),!_base.state.error||(_base.state.restoreFromSnapshot(t),parseParenAndDistinguishExpression(!1),!1))}function shouldParseArrow(){return _index3.match.call(void 0,_types3.TokenType.colon)||!_util.canInsertSemicolon.call(void 0)}function parseArrow(){return _base.isTypeScriptEnabled?_typescript.tsParseArrow.call(void 0):_base.isFlowEnabled?_flow.flowParseArrow.call(void 0):_index3.eat.call(void 0,_types3.TokenType.arrow)}function parseParenItem(){(_base.isTypeScriptEnabled||_base.isFlowEnabled)&&_types.typedParseParenItem.call(void 0)}function parseNew(){_util.expect.call(void 0,_types3.TokenType._new),_index3.eat.call(void 0,_types3.TokenType.dot)?parseIdentifier():(parseNewCallee(),_base.isFlowEnabled&&_flow.flowStartParseNewArguments.call(void 0),_index3.eat.call(void 0,_types3.TokenType.parenL)&&parseExprList(_types3.TokenType.parenR))}function parseNewCallee(){parseNoCallExpr(),_index3.eat.call(void 0,_types3.TokenType.questionDot)}function parseTemplate(){for(_index3.nextTemplateToken.call(void 0),_index3.nextTemplateToken.call(void 0);!_index3.match.call(void 0,_types3.TokenType.backQuote)&&!_base.state.error;)_util.expect.call(void 0,_types3.TokenType.dollarBraceL),parseExpression(),_index3.nextTemplateToken.call(void 0),_index3.nextTemplateToken.call(void 0);_index3.next.call(void 0)}function parseObj(e,t){const s=_base.getNextContextId.call(void 0);let a=!0;for(_index3.next.call(void 0),_base.state.tokens[_base.state.tokens.length-1].contextId=s;!_index3.eat.call(void 0,_types3.TokenType.braceR)&&!_base.state.error;){if(a)a=!1;else if(_util.expect.call(void 0,_types3.TokenType.comma),_index3.eat.call(void 0,_types3.TokenType.braceR))break;let n=!1;if(_index3.match.call(void 0,_types3.TokenType.ellipsis)){const s=_base.state.tokens.length;if(_lval.parseSpread.call(void 0),e&&(_base.state.tokens.length===s+2&&_lval.markPriorBindingIdentifier.call(void 0,t),_index3.eat.call(void 0,_types3.TokenType.braceR)))break;continue}e||(n=_index3.eat.call(void 0,_types3.TokenType.star)),!e&&_util.isContextual.call(void 0,_keywords.ContextualKeyword._async)?(n&&_util.unexpected.call(void 0),parseIdentifier(),_index3.match.call(void 0,_types3.TokenType.colon)||_index3.match.call(void 0,_types3.TokenType.parenL)||_index3.match.call(void 0,_types3.TokenType.braceR)||_index3.match.call(void 0,_types3.TokenType.eq)||_index3.match.call(void 0,_types3.TokenType.comma)||(_index3.match.call(void 0,_types3.TokenType.star)&&(_index3.next.call(void 0),n=!0),parsePropertyName(s))):parsePropertyName(s),parseObjPropValue(e,t,s)}_base.state.tokens[_base.state.tokens.length-1].contextId=s}function isGetterOrSetterMethod(e){return!e&&(_index3.match.call(void 0,_types3.TokenType.string)||_index3.match.call(void 0,_types3.TokenType.num)||_index3.match.call(void 0,_types3.TokenType.bracketL)||_index3.match.call(void 0,_types3.TokenType.name)||!!(_base.state.type&_types3.TokenType.IS_KEYWORD))}function parseObjectMethod(e,t){const s=_base.state.start;return _index3.match.call(void 0,_types3.TokenType.parenL)?(e&&_util.unexpected.call(void 0),parseMethod(s,!1),!0):!!isGetterOrSetterMethod(e)&&(parsePropertyName(t),parseMethod(s,!1),!0)}function parseObjectProperty(e,t){if(_index3.eat.call(void 0,_types3.TokenType.colon))return void(e?_lval.parseMaybeDefault.call(void 0,t):parseMaybeAssign(!1));let s;s=e?0===_base.state.scopeDepth?_index3.IdentifierRole.ObjectShorthandTopLevelDeclaration:t?_index3.IdentifierRole.ObjectShorthandBlockScopedDeclaration:_index3.IdentifierRole.ObjectShorthandFunctionScopedDeclaration:_index3.IdentifierRole.ObjectShorthand,_base.state.tokens[_base.state.tokens.length-1].identifierRole=s,_lval.parseMaybeDefault.call(void 0,t,!0)}function parseObjPropValue(e,t,s){_base.isTypeScriptEnabled?_typescript.tsStartParseObjPropValue.call(void 0):_base.isFlowEnabled&&_flow.flowStartParseObjPropValue.call(void 0),parseObjectMethod(e,s)||parseObjectProperty(e,t)}function parsePropertyName(e){_base.isFlowEnabled&&_flow.flowParseVariance.call(void 0),_index3.eat.call(void 0,_types3.TokenType.bracketL)?(_base.state.tokens[_base.state.tokens.length-1].contextId=e,parseMaybeAssign(),_util.expect.call(void 0,_types3.TokenType.bracketR),_base.state.tokens[_base.state.tokens.length-1].contextId=e):(_index3.match.call(void 0,_types3.TokenType.num)||_index3.match.call(void 0,_types3.TokenType.string)||_index3.match.call(void 0,_types3.TokenType.bigint)||_index3.match.call(void 0,_types3.TokenType.decimal)?parseExprAtom():parseMaybePrivateName(),_base.state.tokens[_base.state.tokens.length-1].identifierRole=_index3.IdentifierRole.ObjectKey,_base.state.tokens[_base.state.tokens.length-1].contextId=e)}function parseMethod(e,t){const s=_base.getNextContextId.call(void 0);_base.state.scopeDepth++;const a=_base.state.tokens.length,n=t;_statement.parseFunctionParams.call(void 0,n,s),parseFunctionBodyAndFinish(e,s);const o=_base.state.tokens.length;_base.state.scopes.push(new(0,_state.Scope)(a,o,!0)),_base.state.scopeDepth--}function parseArrowExpression(e){parseFunctionBody(!0);const t=_base.state.tokens.length;_base.state.scopes.push(new(0,_state.Scope)(e,t,!0)),_base.state.scopeDepth--}function parseFunctionBodyAndFinish(e,t=0){_base.isTypeScriptEnabled?_typescript.tsParseFunctionBodyAndFinish.call(void 0,e,t):_base.isFlowEnabled?_flow.flowParseFunctionBodyAndFinish.call(void 0,t):parseFunctionBody(!1,t)}function parseFunctionBody(e,t=0){e&&!_index3.match.call(void 0,_types3.TokenType.braceL)?parseMaybeAssign():_statement.parseBlock.call(void 0,!0,t)}function parseExprList(e,t=!1){let s=!0;for(;!_index3.eat.call(void 0,e)&&!_base.state.error;){if(s)s=!1;else if(_util.expect.call(void 0,_types3.TokenType.comma),_index3.eat.call(void 0,e))break;parseExprListItem(t)}}function parseExprListItem(e){e&&_index3.match.call(void 0,_types3.TokenType.comma)||(_index3.match.call(void 0,_types3.TokenType.ellipsis)?(_lval.parseSpread.call(void 0),parseParenItem()):_index3.match.call(void 0,_types3.TokenType.question)?_index3.next.call(void 0):parseMaybeAssign(!1,!0))}function parseIdentifier(){_index3.next.call(void 0),_base.state.tokens[_base.state.tokens.length-1].type=_types3.TokenType.name}function parseAwait(){parseMaybeUnary()}function parseYield(){_index3.next.call(void 0),_index3.match.call(void 0,_types3.TokenType.semi)||_util.canInsertSemicolon.call(void 0)||(_index3.eat.call(void 0,_types3.TokenType.star),parseMaybeAssign())}function parseModuleExpression(){_util.expectContextual.call(void 0,_keywords.ContextualKeyword._module),_util.expect.call(void 0,_types3.TokenType.braceL),_statement.parseBlockBody.call(void 0,_types3.TokenType.braceR)}exports.StopState=StopState,exports.parseExpression=parseExpression,exports.parseMaybeAssign=parseMaybeAssign,exports.baseParseMaybeAssign=baseParseMaybeAssign,exports.baseParseConditional=baseParseConditional,exports.parseMaybeUnary=parseMaybeUnary,exports.parseExprSubscripts=parseExprSubscripts,exports.baseParseSubscripts=baseParseSubscripts,exports.baseParseSubscript=baseParseSubscript,exports.atPossibleAsync=atPossibleAsync,exports.parseCallExpressionArguments=parseCallExpressionArguments,exports.parseExprAtom=parseExprAtom,exports.parseLiteral=parseLiteral,exports.parseParenExpression=parseParenExpression,exports.parseArrow=parseArrow,exports.parseTemplate=parseTemplate,exports.parseObj=parseObj,exports.parsePropertyName=parsePropertyName,exports.parseMethod=parseMethod,exports.parseArrowExpression=parseArrowExpression,exports.parseFunctionBodyAndFinish=parseFunctionBodyAndFinish,exports.parseFunctionBody=parseFunctionBody,exports.parseIdentifier=parseIdentifier;