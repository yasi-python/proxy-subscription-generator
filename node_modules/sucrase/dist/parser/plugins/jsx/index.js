"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index=require("../../tokenizer/index"),_types=require("../../tokenizer/types"),_base=require("../../traverser/base"),_expression=require("../../traverser/expression"),_util=require("../../traverser/util"),_charcodes=require("../../util/charcodes"),_identifier=require("../../util/identifier"),_typescript=require("../typescript");function jsxReadToken(){let e=!1,s=!1;for(;;){if(_base.state.pos>=_base.input.length)return void _util.unexpected.call(void 0,"Unterminated JSX contents");const t=_base.input.charCodeAt(_base.state.pos);if(t===_charcodes.charCodes.lessThan||t===_charcodes.charCodes.leftCurlyBrace)return _base.state.pos===_base.state.start?t===_charcodes.charCodes.lessThan?(_base.state.pos++,void _index.finishToken.call(void 0,_types.TokenType.jsxTagStart)):void _index.getTokenFromCode.call(void 0,t):void(e&&!s?_index.finishToken.call(void 0,_types.TokenType.jsxEmptyText):_index.finishToken.call(void 0,_types.TokenType.jsxText));t===_charcodes.charCodes.lineFeed?e=!0:t!==_charcodes.charCodes.space&&t!==_charcodes.charCodes.carriageReturn&&t!==_charcodes.charCodes.tab&&(s=!0),_base.state.pos++}}function jsxReadString(e){for(_base.state.pos++;;){if(_base.state.pos>=_base.input.length)return void _util.unexpected.call(void 0,"Unterminated string constant");if(_base.input.charCodeAt(_base.state.pos)===e){_base.state.pos++;break}_base.state.pos++}_index.finishToken.call(void 0,_types.TokenType.string)}function jsxReadWord(){let e;do{if(_base.state.pos>_base.input.length)return void _util.unexpected.call(void 0,"Unexpectedly reached the end of input.");e=_base.input.charCodeAt(++_base.state.pos)}while(_identifier.IS_IDENTIFIER_CHAR[e]||e===_charcodes.charCodes.dash);_index.finishToken.call(void 0,_types.TokenType.jsxName)}function jsxParseIdentifier(){nextJSXTagToken()}function jsxParseNamespacedName(e){jsxParseIdentifier(),_index.eat.call(void 0,_types.TokenType.colon)?jsxParseIdentifier():_base.state.tokens[_base.state.tokens.length-1].identifierRole=e}function jsxParseElementName(){const e=_base.state.tokens.length;jsxParseNamespacedName(_index.IdentifierRole.Access);let s=!1;for(;_index.match.call(void 0,_types.TokenType.dot);)s=!0,nextJSXTagToken(),jsxParseIdentifier();if(!s){const s=_base.state.tokens[e],t=_base.input.charCodeAt(s.start);t>=_charcodes.charCodes.lowercaseA&&t<=_charcodes.charCodes.lowercaseZ&&(s.identifierRole=null)}}function jsxParseAttributeValue(){switch(_base.state.type){case _types.TokenType.braceL:return _index.next.call(void 0),_expression.parseExpression.call(void 0),void nextJSXTagToken();case _types.TokenType.jsxTagStart:return jsxParseElement(),void nextJSXTagToken();case _types.TokenType.string:return void nextJSXTagToken();default:_util.unexpected.call(void 0,"JSX value should be either an expression or a quoted JSX text")}}function jsxParseSpreadChild(){_util.expect.call(void 0,_types.TokenType.ellipsis),_expression.parseExpression.call(void 0)}function jsxParseOpeningElement(e){if(_index.match.call(void 0,_types.TokenType.jsxTagEnd))return!1;jsxParseElementName(),_base.isTypeScriptEnabled&&_typescript.tsTryParseJSXTypeArgument.call(void 0);let s=!1;for(;!_index.match.call(void 0,_types.TokenType.slash)&&!_index.match.call(void 0,_types.TokenType.jsxTagEnd)&&!_base.state.error;)_index.eat.call(void 0,_types.TokenType.braceL)?(s=!0,_util.expect.call(void 0,_types.TokenType.ellipsis),_expression.parseMaybeAssign.call(void 0),nextJSXTagToken()):(s&&_base.state.end-_base.state.start===3&&_base.input.charCodeAt(_base.state.start)===_charcodes.charCodes.lowercaseK&&_base.input.charCodeAt(_base.state.start+1)===_charcodes.charCodes.lowercaseE&&_base.input.charCodeAt(_base.state.start+2)===_charcodes.charCodes.lowercaseY&&(_base.state.tokens[e].jsxRole=_index.JSXRole.KeyAfterPropSpread),jsxParseNamespacedName(_index.IdentifierRole.ObjectKey),_index.match.call(void 0,_types.TokenType.eq)&&(nextJSXTagToken(),jsxParseAttributeValue()));const t=_index.match.call(void 0,_types.TokenType.slash);return t&&nextJSXTagToken(),t}function jsxParseClosingElement(){_index.match.call(void 0,_types.TokenType.jsxTagEnd)||jsxParseElementName()}function jsxParseElementAt(){const e=_base.state.tokens.length-1;_base.state.tokens[e].jsxRole=_index.JSXRole.NoChildren;let s=0;if(!jsxParseOpeningElement(e))for(nextJSXExprToken();;)switch(_base.state.type){case _types.TokenType.jsxTagStart:if(nextJSXTagToken(),_index.match.call(void 0,_types.TokenType.slash))return nextJSXTagToken(),jsxParseClosingElement(),void(_base.state.tokens[e].jsxRole!==_index.JSXRole.KeyAfterPropSpread&&(1===s?_base.state.tokens[e].jsxRole=_index.JSXRole.OneChild:s>1&&(_base.state.tokens[e].jsxRole=_index.JSXRole.StaticChildren)));s++,jsxParseElementAt(),nextJSXExprToken();break;case _types.TokenType.jsxText:s++,nextJSXExprToken();break;case _types.TokenType.jsxEmptyText:nextJSXExprToken();break;case _types.TokenType.braceL:_index.next.call(void 0),_index.match.call(void 0,_types.TokenType.ellipsis)?(jsxParseSpreadChild(),nextJSXExprToken(),s+=2):(_index.match.call(void 0,_types.TokenType.braceR)||(s++,_expression.parseExpression.call(void 0)),nextJSXExprToken());break;default:return void _util.unexpected.call(void 0)}}function jsxParseElement(){nextJSXTagToken(),jsxParseElementAt()}function nextJSXTagToken(){_base.state.tokens.push(new(0,_index.Token)),_index.skipSpace.call(void 0),_base.state.start=_base.state.pos;const e=_base.input.charCodeAt(_base.state.pos);if(_identifier.IS_IDENTIFIER_START[e])jsxReadWord();else if(e===_charcodes.charCodes.quotationMark||e===_charcodes.charCodes.apostrophe)jsxReadString(e);else switch(++_base.state.pos,e){case _charcodes.charCodes.greaterThan:_index.finishToken.call(void 0,_types.TokenType.jsxTagEnd);break;case _charcodes.charCodes.lessThan:_index.finishToken.call(void 0,_types.TokenType.jsxTagStart);break;case _charcodes.charCodes.slash:_index.finishToken.call(void 0,_types.TokenType.slash);break;case _charcodes.charCodes.equalsTo:_index.finishToken.call(void 0,_types.TokenType.eq);break;case _charcodes.charCodes.leftCurlyBrace:_index.finishToken.call(void 0,_types.TokenType.braceL);break;case _charcodes.charCodes.dot:_index.finishToken.call(void 0,_types.TokenType.dot);break;case _charcodes.charCodes.colon:_index.finishToken.call(void 0,_types.TokenType.colon);break;default:_util.unexpected.call(void 0)}}function nextJSXExprToken(){_base.state.tokens.push(new(0,_index.Token)),_base.state.start=_base.state.pos,jsxReadToken()}exports.jsxParseElement=jsxParseElement,exports.nextJSXTagToken=nextJSXTagToken;