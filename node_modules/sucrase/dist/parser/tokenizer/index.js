"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var IdentifierRole,JSXRole,_base=require("../traverser/base"),_util=require("../traverser/util"),_charcodes=require("../util/charcodes"),_identifier=require("../util/identifier"),_whitespace=require("../util/whitespace"),_keywords=require("./keywords"),_readWord=require("./readWord"),_readWord2=_interopRequireDefault(_readWord),_types=require("./types");function isDeclaration(e){const s=e.identifierRole;return s===IdentifierRole.TopLevelDeclaration||s===IdentifierRole.FunctionScopedDeclaration||s===IdentifierRole.BlockScopedDeclaration||s===IdentifierRole.ObjectShorthandTopLevelDeclaration||s===IdentifierRole.ObjectShorthandFunctionScopedDeclaration||s===IdentifierRole.ObjectShorthandBlockScopedDeclaration}function isNonTopLevelDeclaration(e){const s=e.identifierRole;return s===IdentifierRole.FunctionScopedDeclaration||s===IdentifierRole.BlockScopedDeclaration||s===IdentifierRole.ObjectShorthandFunctionScopedDeclaration||s===IdentifierRole.ObjectShorthandBlockScopedDeclaration}function isTopLevelDeclaration(e){const s=e.identifierRole;return s===IdentifierRole.TopLevelDeclaration||s===IdentifierRole.ObjectShorthandTopLevelDeclaration||s===IdentifierRole.ImportDeclaration}function isBlockScopedDeclaration(e){const s=e.identifierRole;return s===IdentifierRole.TopLevelDeclaration||s===IdentifierRole.BlockScopedDeclaration||s===IdentifierRole.ObjectShorthandTopLevelDeclaration||s===IdentifierRole.ObjectShorthandBlockScopedDeclaration}function isFunctionScopedDeclaration(e){const s=e.identifierRole;return s===IdentifierRole.FunctionScopedDeclaration||s===IdentifierRole.ObjectShorthandFunctionScopedDeclaration}function isObjectShorthandDeclaration(e){return e.identifierRole===IdentifierRole.ObjectShorthandTopLevelDeclaration||e.identifierRole===IdentifierRole.ObjectShorthandBlockScopedDeclaration||e.identifierRole===IdentifierRole.ObjectShorthandFunctionScopedDeclaration}!function(e){e[e.Access=0]="Access",e[e.ExportAccess=1]="ExportAccess",e[e.TopLevelDeclaration=2]="TopLevelDeclaration",e[e.FunctionScopedDeclaration=3]="FunctionScopedDeclaration",e[e.BlockScopedDeclaration=4]="BlockScopedDeclaration",e[e.ObjectShorthandTopLevelDeclaration=5]="ObjectShorthandTopLevelDeclaration",e[e.ObjectShorthandFunctionScopedDeclaration=6]="ObjectShorthandFunctionScopedDeclaration",e[e.ObjectShorthandBlockScopedDeclaration=7]="ObjectShorthandBlockScopedDeclaration",e[e.ObjectShorthand=8]="ObjectShorthand",e[e.ImportDeclaration=9]="ImportDeclaration",e[e.ObjectKey=10]="ObjectKey",e[e.ImportAccess=11]="ImportAccess"}(IdentifierRole||(exports.IdentifierRole=IdentifierRole={})),function(e){e[e.NoChildren=0]="NoChildren",e[e.OneChild=1]="OneChild",e[e.StaticChildren=2]="StaticChildren",e[e.KeyAfterPropSpread=3]="KeyAfterPropSpread"}(JSXRole||(exports.JSXRole=JSXRole={})),exports.isDeclaration=isDeclaration,exports.isNonTopLevelDeclaration=isNonTopLevelDeclaration,exports.isTopLevelDeclaration=isTopLevelDeclaration,exports.isBlockScopedDeclaration=isBlockScopedDeclaration,exports.isFunctionScopedDeclaration=isFunctionScopedDeclaration,exports.isObjectShorthandDeclaration=isObjectShorthandDeclaration;class Token{constructor(){this.type=_base.state.type,this.contextualKeyword=_base.state.contextualKeyword,this.start=_base.state.start,this.end=_base.state.end,this.scopeDepth=_base.state.scopeDepth,this.isType=_base.state.isType,this.identifierRole=null,this.jsxRole=null,this.shadowsGlobal=!1,this.isAsyncOperation=!1,this.contextId=null,this.rhsEndIndex=null,this.isExpression=!1,this.numNullishCoalesceStarts=0,this.numNullishCoalesceEnds=0,this.isOptionalChainStart=!1,this.isOptionalChainEnd=!1,this.subscriptStartIndex=null,this.nullishStartIndex=null}}function next(){_base.state.tokens.push(new Token),nextToken()}function nextTemplateToken(){_base.state.tokens.push(new Token),_base.state.start=_base.state.pos,readTmplToken()}function retokenizeSlashAsRegex(){_base.state.type===_types.TokenType.assign&&--_base.state.pos,readRegexp()}function pushTypeContext(e){for(let s=_base.state.tokens.length-e;s<_base.state.tokens.length;s++)_base.state.tokens[s].isType=!0;const s=_base.state.isType;return _base.state.isType=!0,s}function popTypeContext(e){_base.state.isType=e}function eat(e){return!!match(e)&&(next(),!0)}function eatTypeToken(e){const s=_base.state.isType;_base.state.isType=!0,eat(e),_base.state.isType=s}function match(e){return _base.state.type===e}function lookaheadType(){const e=_base.state.snapshot();next();const s=_base.state.type;return _base.state.restoreFromSnapshot(e),s}exports.Token=Token,exports.next=next,exports.nextTemplateToken=nextTemplateToken,exports.retokenizeSlashAsRegex=retokenizeSlashAsRegex,exports.pushTypeContext=pushTypeContext,exports.popTypeContext=popTypeContext,exports.eat=eat,exports.eatTypeToken=eatTypeToken,exports.match=match,exports.lookaheadType=lookaheadType;class TypeAndKeyword{constructor(e,s){this.type=e,this.contextualKeyword=s}}function lookaheadTypeAndKeyword(){const e=_base.state.snapshot();next();const s=_base.state.type,a=_base.state.contextualKeyword;return _base.state.restoreFromSnapshot(e),new TypeAndKeyword(s,a)}function nextTokenStart(){return nextTokenStartSince(_base.state.pos)}function nextTokenStartSince(e){return _whitespace.skipWhiteSpace.lastIndex=e,e+_whitespace.skipWhiteSpace.exec(_base.input)[0].length}function lookaheadCharCode(){return _base.input.charCodeAt(nextTokenStart())}function nextToken(){if(skipSpace(),_base.state.start=_base.state.pos,_base.state.pos>=_base.input.length){const e=_base.state.tokens;return e.length>=2&&e[e.length-1].start>=_base.input.length&&e[e.length-2].start>=_base.input.length&&_util.unexpected.call(void 0,"Unexpectedly reached the end of input."),void finishToken(_types.TokenType.eof)}readToken(_base.input.charCodeAt(_base.state.pos))}function readToken(e){_identifier.IS_IDENTIFIER_START[e]||e===_charcodes.charCodes.backslash||e===_charcodes.charCodes.atSign&&_base.input.charCodeAt(_base.state.pos+1)===_charcodes.charCodes.atSign?_readWord2.default.call(void 0):getTokenFromCode(e)}function skipBlockComment(){for(;_base.input.charCodeAt(_base.state.pos)!==_charcodes.charCodes.asterisk||_base.input.charCodeAt(_base.state.pos+1)!==_charcodes.charCodes.slash;)if(_base.state.pos++,_base.state.pos>_base.input.length)return void _util.unexpected.call(void 0,"Unterminated comment",_base.state.pos-2);_base.state.pos+=2}function skipLineComment(e){let s=_base.input.charCodeAt(_base.state.pos+=e);if(_base.state.pos<_base.input.length)for(;s!==_charcodes.charCodes.lineFeed&&s!==_charcodes.charCodes.carriageReturn&&s!==_charcodes.charCodes.lineSeparator&&s!==_charcodes.charCodes.paragraphSeparator&&++_base.state.pos<_base.input.length;)s=_base.input.charCodeAt(_base.state.pos)}function skipSpace(){for(;_base.state.pos<_base.input.length;){const e=_base.input.charCodeAt(_base.state.pos);switch(e){case _charcodes.charCodes.carriageReturn:_base.input.charCodeAt(_base.state.pos+1)===_charcodes.charCodes.lineFeed&&++_base.state.pos;case _charcodes.charCodes.lineFeed:case _charcodes.charCodes.lineSeparator:case _charcodes.charCodes.paragraphSeparator:++_base.state.pos;break;case _charcodes.charCodes.slash:switch(_base.input.charCodeAt(_base.state.pos+1)){case _charcodes.charCodes.asterisk:_base.state.pos+=2,skipBlockComment();break;case _charcodes.charCodes.slash:skipLineComment(2);break;default:return}break;default:if(!_whitespace.IS_WHITESPACE[e])return;++_base.state.pos}}}function finishToken(e,s=_keywords.ContextualKeyword.NONE){_base.state.end=_base.state.pos,_base.state.type=e,_base.state.contextualKeyword=s}function readToken_dot(){const e=_base.input.charCodeAt(_base.state.pos+1);e>=_charcodes.charCodes.digit0&&e<=_charcodes.charCodes.digit9?readNumber(!0):e===_charcodes.charCodes.dot&&_base.input.charCodeAt(_base.state.pos+2)===_charcodes.charCodes.dot?(_base.state.pos+=3,finishToken(_types.TokenType.ellipsis)):(++_base.state.pos,finishToken(_types.TokenType.dot))}function readToken_slash(){_base.input.charCodeAt(_base.state.pos+1)===_charcodes.charCodes.equalsTo?finishOp(_types.TokenType.assign,2):finishOp(_types.TokenType.slash,1)}function readToken_mult_modulo(e){let s=e===_charcodes.charCodes.asterisk?_types.TokenType.star:_types.TokenType.modulo,a=1,t=_base.input.charCodeAt(_base.state.pos+1);e===_charcodes.charCodes.asterisk&&t===_charcodes.charCodes.asterisk&&(a++,t=_base.input.charCodeAt(_base.state.pos+2),s=_types.TokenType.exponent),t===_charcodes.charCodes.equalsTo&&_base.input.charCodeAt(_base.state.pos+2)!==_charcodes.charCodes.greaterThan&&(a++,s=_types.TokenType.assign),finishOp(s,a)}function readToken_pipe_amp(e){const s=_base.input.charCodeAt(_base.state.pos+1);if(s!==e){if(e===_charcodes.charCodes.verticalBar){if(s===_charcodes.charCodes.greaterThan)return void finishOp(_types.TokenType.pipeline,2);if(s===_charcodes.charCodes.rightCurlyBrace&&_base.isFlowEnabled)return void finishOp(_types.TokenType.braceBarR,2)}s!==_charcodes.charCodes.equalsTo?finishOp(e===_charcodes.charCodes.verticalBar?_types.TokenType.bitwiseOR:_types.TokenType.bitwiseAND,1):finishOp(_types.TokenType.assign,2)}else _base.input.charCodeAt(_base.state.pos+2)===_charcodes.charCodes.equalsTo?finishOp(_types.TokenType.assign,3):finishOp(e===_charcodes.charCodes.verticalBar?_types.TokenType.logicalOR:_types.TokenType.logicalAND,2)}function readToken_caret(){_base.input.charCodeAt(_base.state.pos+1)===_charcodes.charCodes.equalsTo?finishOp(_types.TokenType.assign,2):finishOp(_types.TokenType.bitwiseXOR,1)}function readToken_plus_min(e){const s=_base.input.charCodeAt(_base.state.pos+1);s!==e?s===_charcodes.charCodes.equalsTo?finishOp(_types.TokenType.assign,2):e===_charcodes.charCodes.plusSign?finishOp(_types.TokenType.plus,1):finishOp(_types.TokenType.minus,1):finishOp(_types.TokenType.preIncDec,2)}function readToken_lt(){const e=_base.input.charCodeAt(_base.state.pos+1);if(e===_charcodes.charCodes.lessThan)return _base.input.charCodeAt(_base.state.pos+2)===_charcodes.charCodes.equalsTo?void finishOp(_types.TokenType.assign,3):void(_base.state.isType?finishOp(_types.TokenType.lessThan,1):finishOp(_types.TokenType.bitShiftL,2));e===_charcodes.charCodes.equalsTo?finishOp(_types.TokenType.relationalOrEqual,2):finishOp(_types.TokenType.lessThan,1)}function readToken_gt(){if(_base.state.isType)return void finishOp(_types.TokenType.greaterThan,1);const e=_base.input.charCodeAt(_base.state.pos+1);if(e===_charcodes.charCodes.greaterThan){const e=_base.input.charCodeAt(_base.state.pos+2)===_charcodes.charCodes.greaterThan?3:2;return _base.input.charCodeAt(_base.state.pos+e)===_charcodes.charCodes.equalsTo?void finishOp(_types.TokenType.assign,e+1):void finishOp(_types.TokenType.bitShiftR,e)}e===_charcodes.charCodes.equalsTo?finishOp(_types.TokenType.relationalOrEqual,2):finishOp(_types.TokenType.greaterThan,1)}function rescan_gt(){_base.state.type===_types.TokenType.greaterThan&&(_base.state.pos-=1,readToken_gt())}function readToken_eq_excl(e){const s=_base.input.charCodeAt(_base.state.pos+1);if(s!==_charcodes.charCodes.equalsTo)return e===_charcodes.charCodes.equalsTo&&s===_charcodes.charCodes.greaterThan?(_base.state.pos+=2,void finishToken(_types.TokenType.arrow)):void finishOp(e===_charcodes.charCodes.equalsTo?_types.TokenType.eq:_types.TokenType.bang,1);finishOp(_types.TokenType.equality,_base.input.charCodeAt(_base.state.pos+2)===_charcodes.charCodes.equalsTo?3:2)}function readToken_question(){const e=_base.input.charCodeAt(_base.state.pos+1),s=_base.input.charCodeAt(_base.state.pos+2);e!==_charcodes.charCodes.questionMark||_base.isFlowEnabled&&_base.state.isType?e!==_charcodes.charCodes.dot||s>=_charcodes.charCodes.digit0&&s<=_charcodes.charCodes.digit9?(++_base.state.pos,finishToken(_types.TokenType.question)):(_base.state.pos+=2,finishToken(_types.TokenType.questionDot)):s===_charcodes.charCodes.equalsTo?finishOp(_types.TokenType.assign,3):finishOp(_types.TokenType.nullishCoalescing,2)}function getTokenFromCode(e){switch(e){case _charcodes.charCodes.numberSign:return++_base.state.pos,void finishToken(_types.TokenType.hash);case _charcodes.charCodes.dot:return void readToken_dot();case _charcodes.charCodes.leftParenthesis:return++_base.state.pos,void finishToken(_types.TokenType.parenL);case _charcodes.charCodes.rightParenthesis:return++_base.state.pos,void finishToken(_types.TokenType.parenR);case _charcodes.charCodes.semicolon:return++_base.state.pos,void finishToken(_types.TokenType.semi);case _charcodes.charCodes.comma:return++_base.state.pos,void finishToken(_types.TokenType.comma);case _charcodes.charCodes.leftSquareBracket:return++_base.state.pos,void finishToken(_types.TokenType.bracketL);case _charcodes.charCodes.rightSquareBracket:return++_base.state.pos,void finishToken(_types.TokenType.bracketR);case _charcodes.charCodes.leftCurlyBrace:return void(_base.isFlowEnabled&&_base.input.charCodeAt(_base.state.pos+1)===_charcodes.charCodes.verticalBar?finishOp(_types.TokenType.braceBarL,2):(++_base.state.pos,finishToken(_types.TokenType.braceL)));case _charcodes.charCodes.rightCurlyBrace:return++_base.state.pos,void finishToken(_types.TokenType.braceR);case _charcodes.charCodes.colon:return void(_base.input.charCodeAt(_base.state.pos+1)===_charcodes.charCodes.colon?finishOp(_types.TokenType.doubleColon,2):(++_base.state.pos,finishToken(_types.TokenType.colon)));case _charcodes.charCodes.questionMark:return void readToken_question();case _charcodes.charCodes.atSign:return++_base.state.pos,void finishToken(_types.TokenType.at);case _charcodes.charCodes.graveAccent:return++_base.state.pos,void finishToken(_types.TokenType.backQuote);case _charcodes.charCodes.digit0:{const e=_base.input.charCodeAt(_base.state.pos+1);if(e===_charcodes.charCodes.lowercaseX||e===_charcodes.charCodes.uppercaseX||e===_charcodes.charCodes.lowercaseO||e===_charcodes.charCodes.uppercaseO||e===_charcodes.charCodes.lowercaseB||e===_charcodes.charCodes.uppercaseB)return void readRadixNumber()}case _charcodes.charCodes.digit1:case _charcodes.charCodes.digit2:case _charcodes.charCodes.digit3:case _charcodes.charCodes.digit4:case _charcodes.charCodes.digit5:case _charcodes.charCodes.digit6:case _charcodes.charCodes.digit7:case _charcodes.charCodes.digit8:case _charcodes.charCodes.digit9:return void readNumber(!1);case _charcodes.charCodes.quotationMark:case _charcodes.charCodes.apostrophe:return void readString(e);case _charcodes.charCodes.slash:return void readToken_slash();case _charcodes.charCodes.percentSign:case _charcodes.charCodes.asterisk:return void readToken_mult_modulo(e);case _charcodes.charCodes.verticalBar:case _charcodes.charCodes.ampersand:return void readToken_pipe_amp(e);case _charcodes.charCodes.caret:return void readToken_caret();case _charcodes.charCodes.plusSign:case _charcodes.charCodes.dash:return void readToken_plus_min(e);case _charcodes.charCodes.lessThan:return void readToken_lt();case _charcodes.charCodes.greaterThan:return void readToken_gt();case _charcodes.charCodes.equalsTo:case _charcodes.charCodes.exclamationMark:return void readToken_eq_excl(e);case _charcodes.charCodes.tilde:return void finishOp(_types.TokenType.tilde,1)}_util.unexpected.call(void 0,`Unexpected character '${String.fromCharCode(e)}'`,_base.state.pos)}function finishOp(e,s){_base.state.pos+=s,finishToken(e)}function readRegexp(){const e=_base.state.pos;let s=!1,a=!1;for(;;){if(_base.state.pos>=_base.input.length)return void _util.unexpected.call(void 0,"Unterminated regular expression",e);const t=_base.input.charCodeAt(_base.state.pos);if(s)s=!1;else{if(t===_charcodes.charCodes.leftSquareBracket)a=!0;else if(t===_charcodes.charCodes.rightSquareBracket&&a)a=!1;else if(t===_charcodes.charCodes.slash&&!a)break;s=t===_charcodes.charCodes.backslash}++_base.state.pos}++_base.state.pos,skipWord(),finishToken(_types.TokenType.regexp)}function readInt(){for(;;){const e=_base.input.charCodeAt(_base.state.pos);if(!(e>=_charcodes.charCodes.digit0&&e<=_charcodes.charCodes.digit9||e===_charcodes.charCodes.underscore))break;_base.state.pos++}}function readRadixNumber(){for(_base.state.pos+=2;;){const e=_base.input.charCodeAt(_base.state.pos);if(!(e>=_charcodes.charCodes.digit0&&e<=_charcodes.charCodes.digit9||e>=_charcodes.charCodes.lowercaseA&&e<=_charcodes.charCodes.lowercaseF||e>=_charcodes.charCodes.uppercaseA&&e<=_charcodes.charCodes.uppercaseF||e===_charcodes.charCodes.underscore))break;_base.state.pos++}_base.input.charCodeAt(_base.state.pos)===_charcodes.charCodes.lowercaseN?(++_base.state.pos,finishToken(_types.TokenType.bigint)):finishToken(_types.TokenType.num)}function readNumber(e){let s=!1,a=!1;e||readInt();let t=_base.input.charCodeAt(_base.state.pos);t===_charcodes.charCodes.dot&&(++_base.state.pos,readInt(),t=_base.input.charCodeAt(_base.state.pos)),t!==_charcodes.charCodes.uppercaseE&&t!==_charcodes.charCodes.lowercaseE||(t=_base.input.charCodeAt(++_base.state.pos),t!==_charcodes.charCodes.plusSign&&t!==_charcodes.charCodes.dash||++_base.state.pos,readInt(),t=_base.input.charCodeAt(_base.state.pos)),t===_charcodes.charCodes.lowercaseN?(++_base.state.pos,s=!0):t===_charcodes.charCodes.lowercaseM&&(++_base.state.pos,a=!0),finishToken(s?_types.TokenType.bigint:a?_types.TokenType.decimal:_types.TokenType.num)}function readString(e){for(_base.state.pos++;;){if(_base.state.pos>=_base.input.length)return void _util.unexpected.call(void 0,"Unterminated string constant");const s=_base.input.charCodeAt(_base.state.pos);if(s===_charcodes.charCodes.backslash)_base.state.pos++;else if(s===e)break;_base.state.pos++}_base.state.pos++,finishToken(_types.TokenType.string)}function readTmplToken(){for(;;){if(_base.state.pos>=_base.input.length)return void _util.unexpected.call(void 0,"Unterminated template");const e=_base.input.charCodeAt(_base.state.pos);if(e===_charcodes.charCodes.graveAccent||e===_charcodes.charCodes.dollarSign&&_base.input.charCodeAt(_base.state.pos+1)===_charcodes.charCodes.leftCurlyBrace)return _base.state.pos===_base.state.start&&match(_types.TokenType.template)?e===_charcodes.charCodes.dollarSign?(_base.state.pos+=2,void finishToken(_types.TokenType.dollarBraceL)):(++_base.state.pos,void finishToken(_types.TokenType.backQuote)):void finishToken(_types.TokenType.template);e===_charcodes.charCodes.backslash&&_base.state.pos++,_base.state.pos++}}function skipWord(){for(;_base.state.pos<_base.input.length;){const e=_base.input.charCodeAt(_base.state.pos);if(_identifier.IS_IDENTIFIER_CHAR[e])_base.state.pos++;else{if(e!==_charcodes.charCodes.backslash)break;if(_base.state.pos+=2,_base.input.charCodeAt(_base.state.pos)===_charcodes.charCodes.leftCurlyBrace){for(;_base.state.pos<_base.input.length&&_base.input.charCodeAt(_base.state.pos)!==_charcodes.charCodes.rightCurlyBrace;)_base.state.pos++;_base.state.pos++}}}}exports.TypeAndKeyword=TypeAndKeyword,exports.lookaheadTypeAndKeyword=lookaheadTypeAndKeyword,exports.nextTokenStart=nextTokenStart,exports.nextTokenStartSince=nextTokenStartSince,exports.lookaheadCharCode=lookaheadCharCode,exports.nextToken=nextToken,exports.skipLineComment=skipLineComment,exports.skipSpace=skipSpace,exports.finishToken=finishToken,exports.rescan_gt=rescan_gt,exports.getTokenFromCode=getTokenFromCode,exports.skipWord=skipWord;