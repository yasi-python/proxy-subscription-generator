import{IdentifierRole,isTopLevelDeclaration}from"../parser/tokenizer";import Transformer from"./Transformer";export default class ReactHotLoaderTransformer extends Transformer{__init(){this.extractedDefaultExportName=null}constructor(e,r){super(),this.tokens=e,this.filePath=r,ReactHotLoaderTransformer.prototype.__init.call(this)}setExtractedDefaultExportName(e){this.extractedDefaultExportName=e}getPrefixCode(){return"\n      (function () {\n        var enterModule = require('react-hot-loader').enterModule;\n        enterModule && enterModule(module);\n      })();".replace(/\s+/g," ").trim()}getSuffixCode(){const e=new Set;for(const r of this.tokens.tokens)!r.isType&&isTopLevelDeclaration(r)&&r.identifierRole!==IdentifierRole.ImportDeclaration&&e.add(this.tokens.identifierNameForToken(r));const r=Array.from(e).map(e=>({variableName:e,uniqueLocalName:e}));return this.extractedDefaultExportName&&r.push({variableName:this.extractedDefaultExportName,uniqueLocalName:"default"}),`\n;(function () {\n  var reactHotLoader = require('react-hot-loader').default;\n  var leaveModule = require('react-hot-loader').leaveModule;\n  if (!reactHotLoader) {\n    return;\n  }\n${r.map(({variableName:e,uniqueLocalName:r})=>`  reactHotLoader.register(${e}, "${r}", ${JSON.stringify(this.filePath||"")});`).join("\n")}\n  leaveModule(module);\n})();`}process(){return!1}}