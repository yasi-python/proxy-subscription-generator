var EventEmitter=require("events").EventEmitter,spawn=require("child_process").spawn,path=require("path"),dirname=path.dirname,basename=path.basename,fs=require("fs");function Option(t,n){this.flags=t,this.required=t.indexOf("<")>=0,this.optional=t.indexOf("[")>=0,this.mandatory=!1,this.negate=-1!==t.indexOf("-no-"),(t=t.split(/[ ,|]+/)).length>1&&!/^[[<]/.test(t[1])&&(this.short=t.shift()),this.long=t.shift(),this.description=n||""}require("util").inherits(Command,EventEmitter),exports=module.exports=new Command,exports.Command=Command,exports.Option=Option,Option.prototype.name=function(){return this.long.replace(/^--/,"")},Option.prototype.attributeName=function(){return camelcase(this.name().replace(/^no-/,""))},Option.prototype.is=function(t){return this.short===t||this.long===t};class CommanderError extends Error{constructor(t,n,e){super(e),Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.code=n,this.exitCode=t}}function Command(t){this.commands=[],this.options=[],this._execs=new Set,this._allowUnknownOption=!1,this._args=[],this._name=t||"",this._optionValues={},this._storeOptionsAsProperties=!0,this._passCommandToAction=!0,this._actionResults=[],this._helpFlags="-h, --help",this._helpDescription="output usage information",this._helpShortFlag="-h",this._helpLongFlag="--help"}function camelcase(t){return t.split("-").reduce(function(t,n){return t+n[0].toUpperCase()+n.slice(1)})}function pad(t,n){var e=Math.max(0,n-t.length);return t+Array(e+1).join(" ")}function wrap(t,n,e){var o=new RegExp(".{1,"+(n-1)+"}([\\s​]|$)|[^\\s​]+?([\\s​]|$)","g");return(t.match(o)||[]).map(function(t,n){return"\n"===t.slice(-1)&&(t=t.slice(0,t.length-1)),(n>0&&e?Array(e+1).join(" "):"")+t.trimRight()}).join("\n")}function optionalWrap(t,n,e){if(t.match(/[\n]\s+/))return t;return n<40?t:wrap(t,n,e)}function outputHelpIfRequested(t,n){n=n||[];for(var e=0;e<n.length;e++)n[e]!==t._helpLongFlag&&n[e]!==t._helpShortFlag||(t.outputHelp(),t._exit(0,"commander.helpDisplayed","(outputHelp)"))}function humanReadableArgName(t){var n=t.name+(!0===t.variadic?"...":"");return t.required?"<"+n+">":"["+n+"]"}function exists(t){try{if(fs.statSync(t).isFile())return!0}catch(t){return!1}}function incrementNodeInspectorPort(t){return t.map(t=>{var n=t;if(0===t.indexOf("--inspect")){var e,o,i="127.0.0.1",s="9229";null!==(o=t.match(/^(--inspect(-brk)?)$/))?e=o[1]:null!==(o=t.match(/^(--inspect(-brk|-port)?)=([^:]+)$/))?(e=o[1],/^\d+$/.test(o[3])?s=o[3]:i=o[3]):null!==(o=t.match(/^(--inspect(-brk|-port)?)=([^:]+):(\d+)$/))&&(e=o[1],i=o[3],s=o[4]),e&&"0"!==s&&(n=`${e}=${i}:${parseInt(s)+1}`)}return n})}exports.CommanderError=CommanderError,Command.prototype.command=function(t,n,e){var o=n,i=e;"object"==typeof o&&null!==o&&(i=o,o=null),i=i||{};var s=t.split(/ +/),r=new Command(s.shift());return o&&(r.description(o),this.executables=!0,this._execs.add(r._name),i.isDefault&&(this.defaultExecutable=r._name)),r._noHelp=!!i.noHelp,r._helpFlags=this._helpFlags,r._helpDescription=this._helpDescription,r._helpShortFlag=this._helpShortFlag,r._helpLongFlag=this._helpLongFlag,r._exitCallback=this._exitCallback,r._storeOptionsAsProperties=this._storeOptionsAsProperties,r._passCommandToAction=this._passCommandToAction,r._executableFile=i.executableFile,this.commands.push(r),r.parseExpectedArgs(s),r.parent=this,o?this:r},Command.prototype.arguments=function(t){return this.parseExpectedArgs(t.split(/ +/))},Command.prototype.addImplicitHelpCommand=function(){this.command("help [cmd]","display help for [cmd]")},Command.prototype.parseExpectedArgs=function(t){if(t.length){var n=this;return t.forEach(function(t){var e={required:!1,name:"",variadic:!1};switch(t[0]){case"<":e.required=!0,e.name=t.slice(1,-1);break;case"[":e.name=t.slice(1,-1)}e.name.length>3&&"..."===e.name.slice(-3)&&(e.variadic=!0,e.name=e.name.slice(0,-3)),e.name&&n._args.push(e)}),this}},Command.prototype.exitOverride=function(t){return this._exitCallback=t||function(t){if("commander.executeSubCommandAsync"!==t.code)throw t},this},Command.prototype._exit=function(t,n,e){this._exitCallback&&this._exitCallback(new CommanderError(t,n,e)),process.exit(t)},Command.prototype.action=function(t){var n=this,e=function(e,o){e=e||[],o=o||[];var i=n.parseOptions(o);outputHelpIfRequested(n,i.unknown),n._checkForMissingMandatoryOptions(),i.unknown.length>0&&n.unknownOption(i.unknown[0]),i.args.length&&(e=i.args.concat(e)),n._args.forEach(function(t,o){t.required&&null==e[o]?n.missingArgument(t.name):t.variadic&&(o!==n._args.length-1&&n.variadicArgNotLast(t.name),e[o]=e.splice(o))});var s=n._args.length,r=e.slice(0,s);n._passCommandToAction?r[s]=n:r[s]=n.opts(),e.length>s&&r.push(e.slice(s));const a=t.apply(n,r);let p=n;for(;p.parent;)p=p.parent;p._actionResults.push(a)},o=this.parent||this,i=o===this?"*":this._name;return o.on("command:"+i,e),this._alias&&o.on("command:"+this._alias,e),this},Command.prototype._optionEx=function(t,n,e,o,i){var s=this,r=new Option(n,e),a=r.name(),p=r.attributeName();if(r.mandatory=!!t.mandatory,"function"!=typeof o)if(o instanceof RegExp){var h=o;o=function(t,n){var e=h.exec(t);return e?e[0]:n}}else i=o,o=null;if(r.negate||r.optional||r.required||"boolean"==typeof i){if(r.negate){const t=r.long.replace(/^--no-/,"--");i=!s.optionFor(t)||s._getOptionValue(p)}void 0!==i&&(s._setOptionValue(p,i),r.defaultValue=i)}return this.options.push(r),this.on("option:"+a,function(t){null!==t&&o&&(t=o(t,void 0===s._getOptionValue(p)?i:s._getOptionValue(p))),"boolean"==typeof s._getOptionValue(p)||void 0===s._getOptionValue(p)?null==t?s._setOptionValue(p,!r.negate&&(i||!0)):s._setOptionValue(p,t):null!==t&&s._setOptionValue(p,!r.negate&&t)}),this},Command.prototype.option=function(t,n,e,o){return this._optionEx({},t,n,e,o)},Command.prototype.requiredOption=function(t,n,e,o){return this._optionEx({mandatory:!0},t,n,e,o)},Command.prototype.allowUnknownOption=function(t){return this._allowUnknownOption=0===arguments.length||t,this},Command.prototype.storeOptionsAsProperties=function(t){return this._storeOptionsAsProperties=void 0===t||t,this.options.length&&console.error("Commander usage error: call storeOptionsAsProperties before adding options"),this},Command.prototype.passCommandToAction=function(t){return this._passCommandToAction=void 0===t||t,this},Command.prototype._setOptionValue=function(t,n){this._storeOptionsAsProperties?this[t]=n:this._optionValues[t]=n},Command.prototype._getOptionValue=function(t){return this._storeOptionsAsProperties?this[t]:this._optionValues[t]},Command.prototype.parse=function(t){this.executables&&this.addImplicitHelpCommand(),this.rawArgs=t,this._name=this._name||basename(t[1],".js"),this.executables&&t.length<3&&!this.defaultExecutable&&t.push(this._helpLongFlag);var n=this.normalize(t.slice(2)),e=this.parseOptions(n),o=this.args=e.args,i=this.parseArgs(this.args,e.unknown);"help"===o[0]&&1===o.length&&this.help(),"help"===o[0]?(o[0]=o[1],o[1]=this._helpLongFlag):this._checkForMissingMandatoryOptions();var s=i.args[0],r=null;return s&&(r=this.commands.find(function(t){return t._name===s})),!r&&s&&(r=this.commands.find(function(t){return t.alias()===s}))&&(s=r._name,o[0]=s),!r&&this.defaultExecutable&&(s=this.defaultExecutable,o.unshift(s),r=this.commands.find(function(t){return t._name===s})),this._execs.has(s)?this.executeSubCommand(t,o,e.unknown,r?r._executableFile:void 0):i},Command.prototype.parseAsync=function(t){return this.parse(t),Promise.all(this._actionResults)},Command.prototype.executeSubCommand=function(t,n,e,o){(n=n.concat(e)).length||this.help();var i,s=!1,r=t[1],a=basename(r,path.extname(r))+"-"+n[0];if(null!=o){a=o;var p=path.extname(o);s=".js"===p||".ts"===p||".mjs"===p}var h=fs.realpathSync(r);i=dirname(h);var m,u=path.join(i,a);exists(u+".js")?(a=u+".js",s=!0):exists(u+".ts")?(a=u+".ts",s=!0):exists(u+".mjs")?(a=u+".mjs",s=!0):exists(u)&&(a=u),n=n.slice(1),"win32"!==process.platform?s?(n.unshift(a),n=incrementNodeInspectorPort(process.execArgv).concat(n),m=spawn(process.argv[0],n,{stdio:"inherit"})):m=spawn(a,n,{stdio:"inherit"}):(n.unshift(a),n=incrementNodeInspectorPort(process.execArgv).concat(n),m=spawn(process.execPath,n,{stdio:"inherit"}));["SIGUSR1","SIGUSR2","SIGTERM","SIGINT","SIGHUP"].forEach(function(t){process.on(t,function(){!1===m.killed&&null===m.exitCode&&m.kill(t)})});const l=this._exitCallback;l?m.on("close",()=>{l(new CommanderError(process.exitCode||0,"commander.executeSubCommandAsync","(close)"))}):m.on("close",process.exit.bind(process)),m.on("error",function(t){if("ENOENT"===t.code?console.error("error: %s(1) does not exist, try --help",a):"EACCES"===t.code&&console.error("error: %s(1) not executable. try chmod or run with root",a),l){const n=new CommanderError(1,"commander.executeSubCommandAsync","(error)");n.nestedError=t,l(n)}else process.exit(1)}),this.runningCommand=m},Command.prototype.normalize=function(t){for(var n,e,o,i,s,r=[],a=0,p=t.length;a<p;++a){if(n=t[a],a>0&&(e=this.optionFor(t[a-1])),"--"===n){r=r.concat(t.slice(a));break}e&&e.required?r.push(n):n.length>2&&"-"===n[0]&&"-"!==n[1]?(i=n.slice(0,2),(s=this.optionFor(i))&&(s.required||s.optional)?(r.push(i),r.push(n.slice(2))):n.slice(1).split("").forEach(function(t){r.push("-"+t)})):/^--/.test(n)&&~(o=n.indexOf("="))?r.push(n.slice(0,o),n.slice(o+1)):r.push(n)}return r},Command.prototype.parseArgs=function(t,n){var e;return t.length?(e=t[0],this.listeners("command:"+e).length?this.emit("command:"+t.shift(),t,n):this.emit("command:*",t,n)):(outputHelpIfRequested(this,n),n.length>0&&!this.defaultExecutable&&this.unknownOption(n[0]),0===this.commands.length&&0===this._args.filter(function(t){return t.required}).length&&this.emit("command:*")),this},Command.prototype.optionFor=function(t){for(var n=0,e=this.options.length;n<e;++n)if(this.options[n].is(t))return this.options[n]},Command.prototype._checkForMissingMandatoryOptions=function(){for(var t=this;t;t=t.parent)t.options.forEach(n=>{n.mandatory&&void 0===t._getOptionValue(n.attributeName())&&t.missingMandatoryOptionValue(n)})},Command.prototype.parseOptions=function(t){for(var n,e,o,i=[],s=t.length,r=[],a=0;a<s;++a)if(o=t[a],n)i.push(o);else if("--"!==o)if(e=this.optionFor(o))if(e.required){if(null==(o=t[++a]))return this.optionMissingArgument(e);this.emit("option:"+e.name(),o)}else e.optional?(null==(o=t[a+1])||"-"===o[0]&&"-"!==o?o=null:++a,this.emit("option:"+e.name(),o)):this.emit("option:"+e.name());else o.length>1&&"-"===o[0]?(r.push(o),a+1<t.length&&("-"!==t[a+1][0]||"-"===t[a+1])&&r.push(t[++a])):i.push(o);else n=!0;return{args:i,unknown:r}},Command.prototype.opts=function(){if(this._storeOptionsAsProperties){for(var t={},n=this.options.length,e=0;e<n;e++){var o=this.options[e].attributeName();t[o]=o===this._versionOptionName?this._version:this[o]}return t}return this._optionValues},Command.prototype.missingArgument=function(t){const n=`error: missing required argument '${t}'`;console.error(n),this._exit(1,"commander.missingArgument",n)},Command.prototype.optionMissingArgument=function(t,n){let e;e=n?`error: option '${t.flags}' argument missing, got '${n}'`:`error: option '${t.flags}' argument missing`,console.error(e),this._exit(1,"commander.optionMissingArgument",e)},Command.prototype.missingMandatoryOptionValue=function(t){const n=`error: required option '${t.flags}' not specified`;console.error(n),this._exit(1,"commander.missingMandatoryOptionValue",n)},Command.prototype.unknownOption=function(t){if(this._allowUnknownOption)return;const n=`error: unknown option '${t}'`;console.error(n),this._exit(1,"commander.unknownOption",n)},Command.prototype.variadicArgNotLast=function(t){const n=`error: variadic arguments must be last '${t}'`;console.error(n),this._exit(1,"commander.variadicArgNotLast",n)},Command.prototype.version=function(t,n,e){if(0===arguments.length)return this._version;this._version=t;var o=new Option(n=n||"-V, --version",e=e||"output the version number");this._versionOptionName=o.long.substr(2)||"version",this.options.push(o);var i=this;return this.on("option:"+this._versionOptionName,function(){process.stdout.write(t+"\n"),i._exit(0,"commander.version",t)}),this},Command.prototype.description=function(t,n){return 0===arguments.length?this._description:(this._description=t,this._argsDescription=n,this)},Command.prototype.alias=function(t){var n=this;if(0!==this.commands.length&&(n=this.commands[this.commands.length-1]),0===arguments.length)return n._alias;if(t===n._name)throw new Error("Command alias can't be the same as its name");return n._alias=t,this},Command.prototype.usage=function(t){var n=this._args.map(function(t){return humanReadableArgName(t)}),e="[options]"+(this.commands.length?" [command]":"")+(this._args.length?" "+n.join(" "):"");return 0===arguments.length?this._usage||e:(this._usage=t,this)},Command.prototype.name=function(t){return 0===arguments.length?this._name:(this._name=t,this)},Command.prototype.prepareCommands=function(){return this.commands.filter(function(t){return!t._noHelp}).map(function(t){var n=t._args.map(function(t){return humanReadableArgName(t)}).join(" ");return[t._name+(t._alias?"|"+t._alias:"")+(t.options.length?" [options]":"")+(n?" "+n:""),t._description]})},Command.prototype.largestCommandLength=function(){return this.prepareCommands().reduce(function(t,n){return Math.max(t,n[0].length)},0)},Command.prototype.largestOptionLength=function(){var t=[].slice.call(this.options);return t.push({flags:this._helpFlags}),t.reduce(function(t,n){return Math.max(t,n.flags.length)},0)},Command.prototype.largestArgLength=function(){return this._args.reduce(function(t,n){return Math.max(t,n.name.length)},0)},Command.prototype.padWidth=function(){var t=this.largestOptionLength();return this._argsDescription&&this._args.length&&this.largestArgLength()>t&&(t=this.largestArgLength()),this.commands&&this.commands.length&&this.largestCommandLength()>t&&(t=this.largestCommandLength()),t},Command.prototype.optionHelp=function(){var t=this.padWidth(),n=(process.stdout.columns||80)-t-4;return this.options.map(function(e){const o=e.description+(e.negate||void 0===e.defaultValue?"":" (default: "+JSON.stringify(e.defaultValue)+")");return pad(e.flags,t)+"  "+optionalWrap(o,n,t+2)}).concat([pad(this._helpFlags,t)+"  "+optionalWrap(this._helpDescription,n,t+2)]).join("\n")},Command.prototype.commandHelp=function(){if(!this.commands.length)return"";var t=this.prepareCommands(),n=this.padWidth(),e=(process.stdout.columns||80)-n-4;return["Commands:",t.map(function(t){var o=t[1]?"  "+t[1]:"";return(o?pad(t[0],n):t[0])+optionalWrap(o,e,n+2)}).join("\n").replace(/^/gm,"  "),""].join("\n")},Command.prototype.helpInformation=function(){var t=[];if(this._description){t=[this._description,""];var n=this._argsDescription;if(n&&this._args.length){var e=this.padWidth(),o=(process.stdout.columns||80)-e-5;t.push("Arguments:"),t.push(""),this._args.forEach(function(i){t.push("  "+pad(i.name,e)+"  "+wrap(n[i.name],o,e+4))}),t.push("")}}var i=this._name;this._alias&&(i=i+"|"+this._alias);for(var s="",r=this.parent;r;r=r.parent)s=r.name()+" "+s;var a=["Usage: "+s+i+" "+this.usage(),""],p=[],h=this.commandHelp();h&&(p=[h]);var m=["Options:",""+this.optionHelp().replace(/^/gm,"  "),""];return a.concat(t).concat(m).concat(p).join("\n")},Command.prototype.outputHelp=function(t){t||(t=function(t){return t});const n=t(this.helpInformation());if("string"!=typeof n&&!Buffer.isBuffer(n))throw new Error("outputHelp callback must return a string or a Buffer");process.stdout.write(n),this.emit(this._helpLongFlag)},Command.prototype.helpOption=function(t,n){this._helpFlags=t||this._helpFlags,this._helpDescription=n||this._helpDescription;var e=this._helpFlags.split(/[ ,|]+/);return e.length>1&&(this._helpShortFlag=e.shift()),this._helpLongFlag=e.shift(),this},Command.prototype.help=function(t){this.outputHelp(t),this._exit(process.exitCode||0,"commander.help","(outputHelp)")};