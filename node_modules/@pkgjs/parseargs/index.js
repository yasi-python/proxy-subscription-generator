"use strict";const{ArrayPrototypeForEach:ArrayPrototypeForEach,ArrayPrototypeIncludes:ArrayPrototypeIncludes,ArrayPrototypeMap:ArrayPrototypeMap,ArrayPrototypePush:ArrayPrototypePush,ArrayPrototypePushApply:ArrayPrototypePushApply,ArrayPrototypeShift:ArrayPrototypeShift,ArrayPrototypeSlice:ArrayPrototypeSlice,ArrayPrototypeUnshiftApply:ArrayPrototypeUnshiftApply,ObjectEntries:ObjectEntries,ObjectPrototypeHasOwnProperty:ObjectHasOwn,StringPrototypeCharAt:StringPrototypeCharAt,StringPrototypeIndexOf:StringPrototypeIndexOf,StringPrototypeSlice:StringPrototypeSlice,StringPrototypeStartsWith:StringPrototypeStartsWith}=require("./internal/primordials"),{validateArray:validateArray,validateBoolean:validateBoolean,validateBooleanArray:validateBooleanArray,validateObject:validateObject,validateString:validateString,validateStringArray:validateStringArray,validateUnion:validateUnion}=require("./internal/validators"),{kEmptyObject:kEmptyObject}=require("./internal/util"),{findLongOptionForShort:findLongOptionForShort,isLoneLongOption:isLoneLongOption,isLoneShortOption:isLoneShortOption,isLongOptionAndValue:isLongOptionAndValue,isOptionValue:isOptionValue,isOptionLikeValue:isOptionLikeValue,isShortOptionAndValue:isShortOptionAndValue,isShortOptionGroup:isShortOptionGroup,useDefaultValueOption:useDefaultValueOption,objectGetOwn:objectGetOwn,optionsGetOwn:optionsGetOwn}=require("./utils"),{codes:{ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE,ERR_PARSE_ARGS_INVALID_OPTION_VALUE:ERR_PARSE_ARGS_INVALID_OPTION_VALUE,ERR_PARSE_ARGS_UNKNOWN_OPTION:ERR_PARSE_ARGS_UNKNOWN_OPTION,ERR_PARSE_ARGS_UNEXPECTED_POSITIONAL:ERR_PARSE_ARGS_UNEXPECTED_POSITIONAL}}=require("./internal/errors");function getMainArgs(){const t=process.execArgv;return ArrayPrototypeIncludes(t,"-e")||ArrayPrototypeIncludes(t,"--eval")||ArrayPrototypeIncludes(t,"-p")||ArrayPrototypeIncludes(t,"--print")?ArrayPrototypeSlice(process.argv,1):ArrayPrototypeSlice(process.argv,2)}function checkOptionLikeValue(t){if(!t.inlineValue&&isOptionLikeValue(t.value)){const o=StringPrototypeStartsWith(t.rawName,"--")?`'${t.rawName}=-XYZ'`:`'--${t.name}=-XYZ' or '${t.rawName}-XYZ'`,e=`Option '${t.rawName}' argument is ambiguous.\nDid you forget to specify the option argument for '${t.rawName}'?\nTo specify an option argument starting with a dash use ${o}.`;throw new ERR_PARSE_ARGS_INVALID_OPTION_VALUE(e)}}function checkOptionUsage(t,o){if(!ObjectHasOwn(t.options,o.name))throw new ERR_PARSE_ARGS_UNKNOWN_OPTION(o.rawName,t.allowPositionals);const e=optionsGetOwn(t.options,o.name,"short"),r=`${e?`-${e}, `:""}--${o.name}`,n=optionsGetOwn(t.options,o.name,"type");if("string"===n&&"string"!=typeof o.value)throw new ERR_PARSE_ARGS_INVALID_OPTION_VALUE(`Option '${r} <value>' argument missing`);if("boolean"===n&&null!=o.value)throw new ERR_PARSE_ARGS_INVALID_OPTION_VALUE(`Option '${r}' does not take an argument`)}function storeOption(t,o,e,r){if("__proto__"===t)return;const n=o??!0;optionsGetOwn(e,t,"multiple")?r[t]?ArrayPrototypePush(r[t],n):r[t]=[n]:r[t]=n}function storeDefaultOption(t,o,e){"__proto__"!==t&&(e[t]=o)}function argsToTokens(t,o){const e=[];let r=-1,n=0;const i=ArrayPrototypeSlice(t);for(;i.length>0;){const t=ArrayPrototypeShift(i),a=i[0];if(n>0?n--:r++,"--"===t){ArrayPrototypePush(e,{kind:"option-terminator",index:r}),ArrayPrototypePushApply(e,ArrayPrototypeMap(i,t=>({kind:"positional",index:++r,value:t})));break}if(isLoneShortOption(t)){const n=StringPrototypeCharAt(t,1),s=findLongOptionForShort(n,o);let p,l;"string"===optionsGetOwn(o,s,"type")&&isOptionValue(a)&&(p=ArrayPrototypeShift(i),l=!1),ArrayPrototypePush(e,{kind:"option",name:s,rawName:t,index:r,value:p,inlineValue:l}),null!=p&&++r;continue}if(isShortOptionGroup(t,o)){const e=[];for(let r=1;r<t.length;r++){const n=StringPrototypeCharAt(t,r),i=findLongOptionForShort(n,o);if("string"===optionsGetOwn(o,i,"type")&&r!==t.length-1){ArrayPrototypePush(e,`-${StringPrototypeSlice(t,r)}`);break}ArrayPrototypePush(e,`-${n}`)}ArrayPrototypeUnshiftApply(i,e),n=e.length;continue}if(isShortOptionAndValue(t,o)){const n=StringPrototypeCharAt(t,1),i=findLongOptionForShort(n,o),a=StringPrototypeSlice(t,2);ArrayPrototypePush(e,{kind:"option",name:i,rawName:`-${n}`,index:r,value:a,inlineValue:!0});continue}if(isLoneLongOption(t)){const n=StringPrototypeSlice(t,2);let s,p;"string"===optionsGetOwn(o,n,"type")&&isOptionValue(a)&&(s=ArrayPrototypeShift(i),p=!1),ArrayPrototypePush(e,{kind:"option",name:n,rawName:t,index:r,value:s,inlineValue:p}),null!=s&&++r;continue}if(isLongOptionAndValue(t)){const o=StringPrototypeIndexOf(t,"="),n=StringPrototypeSlice(t,2,o),i=StringPrototypeSlice(t,o+1);ArrayPrototypePush(e,{kind:"option",name:n,rawName:`--${n}`,index:r,value:i,inlineValue:!0});continue}ArrayPrototypePush(e,{kind:"positional",index:r,value:t})}return e}const parseArgs=(t=kEmptyObject)=>{const o=objectGetOwn(t,"args")??getMainArgs(),e=objectGetOwn(t,"strict")??!0,r=objectGetOwn(t,"allowPositionals")??!e,n=objectGetOwn(t,"tokens")??!1,i=objectGetOwn(t,"options")??{__proto__:null},a={args:o,strict:e,options:i,allowPositionals:r};validateArray(o,"args"),validateBoolean(e,"strict"),validateBoolean(r,"allowPositionals"),validateBoolean(n,"tokens"),validateObject(i,"options"),ArrayPrototypeForEach(ObjectEntries(i),({0:t,1:o})=>{validateObject(o,`options.${t}`);const e=objectGetOwn(o,"type");if(validateUnion(e,`options.${t}.type`,["string","boolean"]),ObjectHasOwn(o,"short")){const e=o.short;if(validateString(e,`options.${t}.short`),1!==e.length)throw new ERR_INVALID_ARG_VALUE(`options.${t}.short`,e,"must be a single character")}const r=objectGetOwn(o,"multiple");ObjectHasOwn(o,"multiple")&&validateBoolean(r,`options.${t}.multiple`);const n=objectGetOwn(o,"default");if(void 0!==n){let o;switch(e){case"string":o=r?validateStringArray:validateString;break;case"boolean":o=r?validateBooleanArray:validateBoolean}o(n,`options.${t}.default`)}});const s=argsToTokens(o,i),p={values:{__proto__:null},positionals:[]};return n&&(p.tokens=s),ArrayPrototypeForEach(s,t=>{if("option"===t.kind)e&&(checkOptionUsage(a,t),checkOptionLikeValue(t)),storeOption(t.name,t.value,i,p.values);else if("positional"===t.kind){if(!r)throw new ERR_PARSE_ARGS_UNEXPECTED_POSITIONAL(t.value);ArrayPrototypePush(p.positionals,t.value)}}),ArrayPrototypeForEach(ObjectEntries(i),({0:t,1:o})=>{useDefaultValueOption(t,o,p.values)&&storeDefaultOption(t,objectGetOwn(o,"default"),p.values)}),p};module.exports={parseArgs:parseArgs};