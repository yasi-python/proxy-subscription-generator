import{hasAnchor}from"./identity.js";function toJS(t,r,e){if(Array.isArray(t))return t.map((t,r)=>toJS(t,String(r),e));if(t&&"function"==typeof t.toJSON){if(!e||!hasAnchor(t))return t.toJSON(r,e);const o={aliasCount:0,count:1,res:void 0};e.anchors.set(t,o),e.onCreate=t=>{o.res=t,delete e.onCreate};const n=t.toJSON(r,e);return e.onCreate&&e.onCreate(n),n}return"bigint"!=typeof t||e?.keep?t:Number(t)}export{toJS};