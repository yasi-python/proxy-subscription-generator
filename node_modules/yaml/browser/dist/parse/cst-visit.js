const BREAK=Symbol("break visit"),SKIP=Symbol("skip children"),REMOVE=Symbol("remove item");function visit(t,e){"type"in t&&"document"===t.type&&(t={start:t.start,value:t.value}),_visit(Object.freeze([]),t,e)}function _visit(t,e,i){let n=i(e,t);if("symbol"==typeof n)return n;for(const o of["key","value"]){const s=e[o];if(s&&"items"in s){for(let e=0;e<s.items.length;++e){const n=_visit(Object.freeze(t.concat([[o,e]])),s.items[e],i);if("number"==typeof n)e=n-1;else{if(n===BREAK)return BREAK;n===REMOVE&&(s.items.splice(e,1),e-=1)}}"function"==typeof n&&"key"===o&&(n=n(e,t))}}return"function"==typeof n?n(e,t):n}visit.BREAK=BREAK,visit.SKIP=SKIP,visit.REMOVE=REMOVE,visit.itemAtPath=(t,e)=>{let i=t;for(const[t,n]of e){const e=i?.[t];if(!e||!("items"in e))return;i=e.items[n]}return i},visit.parentCollection=(t,e)=>{const i=visit.itemAtPath(t,e.slice(0,-1)),n=e[e.length-1][0],o=i?.[n];if(o&&"items"in o)return o;throw new Error("Parent collection not found")};export{visit};