"use strict";var Alias=require("../nodes/Alias.js"),identity=require("../nodes/identity.js"),composeCollection=require("./compose-collection.js"),composeScalar=require("./compose-scalar.js"),resolveEnd=require("./resolve-end.js"),utilEmptyScalarPosition=require("./util-empty-scalar-position.js");const CN={composeNode:composeNode,composeEmptyNode:composeEmptyNode};function composeNode(e,o,s,t){const c=e.atKey,{spaceBefore:n,comment:r,anchor:a,tag:i}=s;let l,p=!0;switch(o.type){case"alias":l=composeAlias(e,o,t),(a||i)&&t(o,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":l=composeScalar.composeScalar(e,o,i,t),a&&(l.anchor=a.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":l=composeCollection.composeCollection(CN,e,o,s,t),a&&(l.anchor=a.source.substring(1));break;default:t(o,"UNEXPECTED_TOKEN","error"===o.type?o.message:`Unsupported token (type: ${o.type})`),l=composeEmptyNode(e,o.offset,void 0,null,s,t),p=!1}return a&&""===l.anchor&&t(a,"BAD_ALIAS","Anchor cannot be an empty string"),c&&e.options.stringKeys&&(!identity.isScalar(l)||"string"!=typeof l.value||l.tag&&"tag:yaml.org,2002:str"!==l.tag)&&t(i??o,"NON_STRING_KEY","With stringKeys, all keys must be strings"),n&&(l.spaceBefore=!0),r&&("scalar"===o.type&&""===o.source?l.comment=r:l.commentBefore=r),e.options.keepSourceTokens&&p&&(l.srcToken=o),l}function composeEmptyNode(e,o,s,t,{spaceBefore:c,comment:n,anchor:r,tag:a,end:i},l){const p={type:"scalar",offset:utilEmptyScalarPosition.emptyScalarPosition(o,s,t),indent:-1,source:""},m=composeScalar.composeScalar(e,p,a,l);return r&&(m.anchor=r.source.substring(1),""===m.anchor&&l(r,"BAD_ALIAS","Anchor cannot be an empty string")),c&&(m.spaceBefore=!0),n&&(m.comment=n,m.range[2]=i),m}function composeAlias({options:e},{offset:o,source:s,end:t},c){const n=new Alias.Alias(s.substring(1));""===n.source&&c(o,"BAD_ALIAS","Alias cannot be an empty string"),n.source.endsWith(":")&&c(o+s.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const r=o+s.length,a=resolveEnd.resolveEnd(t,r,e.strict,c);return n.range=[o,r,a.offset],a.comment&&(n.comment=a.comment),n}exports.composeEmptyNode=composeEmptyNode,exports.composeNode=composeNode;