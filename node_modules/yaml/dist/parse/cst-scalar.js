"use strict";var resolveBlockScalar=require("../compose/resolve-block-scalar.js"),resolveFlowScalar=require("../compose/resolve-flow-scalar.js"),errors=require("../errors.js"),stringifyString=require("../stringify/stringifyString.js");function resolveAsScalar(e,s=!0,r){if(e){const t=(e,s,t)=>{const a="number"==typeof e?e:Array.isArray(e)?e[0]:e.offset;if(!r)throw new errors.YAMLParseError([a,a+1],s,t);r(a,s,t)};switch(e.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return resolveFlowScalar.resolveFlowScalar(e,s,t);case"block-scalar":return resolveBlockScalar.resolveBlockScalar({options:{strict:s}},e,t)}}return null}function createScalarToken(e,s){const{implicitKey:r=!1,indent:t,inFlow:a=!1,offset:n=-1,type:o="PLAIN"}=s,c=stringifyString.stringifyString({type:o,value:e},{implicitKey:r,indent:t>0?" ".repeat(t):"",inFlow:a,options:{blockQuote:!0,lineWidth:-1}}),l=s.end??[{type:"newline",offset:-1,indent:t,source:"\n"}];switch(c[0]){case"|":case">":{const e=c.indexOf("\n"),s=c.substring(0,e),r=c.substring(e+1)+"\n",a=[{type:"block-scalar-header",offset:n,indent:t,source:s}];return addEndtoBlockProps(a,l)||a.push({type:"newline",offset:-1,indent:t,source:"\n"}),{type:"block-scalar",offset:n,indent:t,props:a,source:r}}case'"':return{type:"double-quoted-scalar",offset:n,indent:t,source:c,end:l};case"'":return{type:"single-quoted-scalar",offset:n,indent:t,source:c,end:l};default:return{type:"scalar",offset:n,indent:t,source:c,end:l}}}function setScalarValue(e,s,r={}){let{afterKey:t=!1,implicitKey:a=!1,inFlow:n=!1,type:o}=r,c="indent"in e?e.indent:null;if(t&&"number"==typeof c&&(c+=2),!o)switch(e.type){case"single-quoted-scalar":o="QUOTE_SINGLE";break;case"double-quoted-scalar":o="QUOTE_DOUBLE";break;case"block-scalar":{const s=e.props[0];if("block-scalar-header"!==s.type)throw new Error("Invalid block scalar header");o=">"===s.source[0]?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:o="PLAIN"}const l=stringifyString.stringifyString({type:o,value:s},{implicitKey:a||null===c,indent:null!==c&&c>0?" ".repeat(c):"",inFlow:n,options:{blockQuote:!0,lineWidth:-1}});switch(l[0]){case"|":case">":setBlockScalarValue(e,l);break;case'"':setFlowScalarValue(e,l,"double-quoted-scalar");break;case"'":setFlowScalarValue(e,l,"single-quoted-scalar");break;default:setFlowScalarValue(e,l,"scalar")}}function setBlockScalarValue(e,s){const r=s.indexOf("\n"),t=s.substring(0,r),a=s.substring(r+1)+"\n";if("block-scalar"===e.type){const s=e.props[0];if("block-scalar-header"!==s.type)throw new Error("Invalid block scalar header");s.source=t,e.source=a}else{const{offset:s}=e,r="indent"in e?e.indent:-1,n=[{type:"block-scalar-header",offset:s,indent:r,source:t}];addEndtoBlockProps(n,"end"in e?e.end:void 0)||n.push({type:"newline",offset:-1,indent:r,source:"\n"});for(const s of Object.keys(e))"type"!==s&&"offset"!==s&&delete e[s];Object.assign(e,{type:"block-scalar",indent:r,props:n,source:a})}}function addEndtoBlockProps(e,s){if(s)for(const r of s)switch(r.type){case"space":case"comment":e.push(r);break;case"newline":return e.push(r),!0}return!1}function setFlowScalarValue(e,s,r){switch(e.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":e.type=r,e.source=s;break;case"block-scalar":{const t=e.props.slice(1);let a=s.length;"block-scalar-header"===e.props[0].type&&(a-=e.props[0].source.length);for(const e of t)e.offset+=a;delete e.props,Object.assign(e,{type:r,source:s,end:t});break}case"block-map":case"block-seq":{const t={type:"newline",offset:e.offset+s.length,indent:e.indent,source:"\n"};delete e.items,Object.assign(e,{type:r,source:s,end:[t]});break}default:{const t="indent"in e?e.indent:-1,a="end"in e&&Array.isArray(e.end)?e.end.filter(e=>"space"===e.type||"comment"===e.type||"newline"===e.type):[];for(const s of Object.keys(e))"type"!==s&&"offset"!==s&&delete e[s];Object.assign(e,{type:r,indent:t,source:s,end:a})}}}exports.createScalarToken=createScalarToken,exports.resolveAsScalar=resolveAsScalar,exports.setScalarValue=setScalarValue;