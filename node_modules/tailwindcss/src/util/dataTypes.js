import{parseColor}from"./color";import{parseBoxShadowValue}from"./parseBoxShadowValue";import{splitAtTopLevelOnly}from"./splitAtTopLevelOnly";let cssFunctions=["min","max","clamp","calc"];function isCSSFunction(e){return cssFunctions.some(t=>new RegExp(`^${t}\\(.*\\)`).test(e))}const AUTO_VAR_INJECTION_EXCEPTIONS=new Set(["scroll-timeline-name","timeline-scope","view-timeline-name","font-palette","anchor-name","anchor-scope","position-anchor","position-try-options","scroll-timeline","animation-timeline","view-timeline","position-try"]);export function normalize(e,t=null,n=!0){let r=t&&AUTO_VAR_INJECTION_EXCEPTIONS.has(t.property);return e.startsWith("--")&&!r?`var(${e})`:e.includes("url(")?e.split(/(url\(.*?\))/g).filter(Boolean).map(e=>/^url\(.*?\)$/.test(e)?e:normalize(e,t,!1)).join(""):(e=e.replace(/([^\\])_+/g,(e,t)=>t+" ".repeat(e.length-1)).replace(/^_/g," ").replace(/\\_/g,"_"),n&&(e=e.trim()),e=normalizeMathOperatorSpacing(e))}export function normalizeAttributeSelectors(e){return e.includes("=")&&(e=e.replace(/(=.*)/g,(e,t)=>{if("'"===t[1]||'"'===t[1])return t;if(t.length>2){let e=t[t.length-1];if(" "===t[t.length-2]&&("i"===e||"I"===e||"s"===e||"S"===e))return`="${t.slice(1,-2)}" ${t[t.length-1]}`}return`="${t.slice(1)}"`})),e}function normalizeMathOperatorSpacing(e){let t=["theme"],n=["min-content","max-content","fit-content","safe-area-inset-top","safe-area-inset-right","safe-area-inset-bottom","safe-area-inset-left","titlebar-area-x","titlebar-area-y","titlebar-area-width","titlebar-area-height","keyboard-inset-top","keyboard-inset-right","keyboard-inset-bottom","keyboard-inset-left","keyboard-inset-width","keyboard-inset-height","radial-gradient","linear-gradient","conic-gradient","repeating-radial-gradient","repeating-linear-gradient","repeating-conic-gradient","anchor-size"];return e.replace(/(calc|min|max|clamp)\(.+\)/g,e=>{let r="";function i(){let e=r.trimEnd();return e[e.length-1]}for(let o=0;o<e.length;o++){function a(t){return t.split("").every((t,n)=>e[o+n]===t)}function l(t){let n=1/0;for(let r of t){let t=e.indexOf(r,o);-1!==t&&t<n&&(n=t)}let r=e.slice(o,n);return o+=r.length-1,r}let s=e[o];if(a("var"))r+=l([")",","]);else if(n.some(e=>a(e))){let c=n.find(e=>a(e));r+=c,o+=c.length-1}else t.some(e=>a(e))?r+=l([")"]):a("[")?r+=l(["]"]):["+","-","*","/"].includes(s)&&!["(","+","-","*","/",","].includes(i())?r+=` ${s} `:r+=s}return r.replace(/\s+/g," ")})}export function url(e){return e.startsWith("url(")}export function number(e){return!isNaN(Number(e))||isCSSFunction(e)}export function percentage(e){return e.endsWith("%")&&number(e.slice(0,-1))||isCSSFunction(e)}let lengthUnits=["cm","mm","Q","in","pc","pt","px","em","ex","ch","rem","lh","rlh","vw","vh","vmin","vmax","vb","vi","svw","svh","lvw","lvh","dvw","dvh","cqw","cqh","cqi","cqb","cqmin","cqmax"],lengthUnitsPattern=`(?:${lengthUnits.join("|")})`;export function length(e){return"0"===e||new RegExp(`^[+-]?[0-9]*.?[0-9]+(?:[eE][+-]?[0-9]+)?${lengthUnitsPattern}$`).test(e)||isCSSFunction(e)}let lineWidths=new Set(["thin","medium","thick"]);export function lineWidth(e){return lineWidths.has(e)}export function shadow(e){let t=parseBoxShadowValue(normalize(e));for(let e of t)if(!e.valid)return!1;return!0}export function color(e){let t=0;return!!splitAtTopLevelOnly(e,"_").every(e=>!!(e=normalize(e)).startsWith("var(")||null!==parseColor(e,{loose:!0})&&(t++,!0))&&t>0}export function image(e){let t=0;return!!splitAtTopLevelOnly(e,",").every(e=>!!(e=normalize(e)).startsWith("var(")||!!(url(e)||gradient(e)||["element(","image(","cross-fade(","image-set("].some(t=>e.startsWith(t)))&&(t++,!0))&&t>0}let gradientTypes=new Set(["conic-gradient","linear-gradient","radial-gradient","repeating-conic-gradient","repeating-linear-gradient","repeating-radial-gradient"]);export function gradient(e){e=normalize(e);for(let t of gradientTypes)if(e.startsWith(`${t}(`))return!0;return!1}let validPositions=new Set(["center","top","right","bottom","left"]);export function position(e){let t=0;return!!splitAtTopLevelOnly(e,"_").every(e=>!!(e=normalize(e)).startsWith("var(")||!!(validPositions.has(e)||length(e)||percentage(e))&&(t++,!0))&&t>0}export function familyName(e){let t=0;return!!splitAtTopLevelOnly(e,",").every(e=>!(!(e=normalize(e)).startsWith("var(")&&(e.includes(" ")&&!/(['"])([^"']+)\1/g.test(e)||/^\d/g.test(e)||(t++,0))))&&t>0}let genericNames=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]);export function genericName(e){return genericNames.has(e)}let absoluteSizes=new Set(["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"]);export function absoluteSize(e){return absoluteSizes.has(e)}let relativeSizes=new Set(["larger","smaller"]);export function relativeSize(e){return relativeSizes.has(e)}