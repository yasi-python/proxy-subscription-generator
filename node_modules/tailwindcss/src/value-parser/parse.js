var openParentheses="(".charCodeAt(0),closeParentheses=")".charCodeAt(0),singleQuote="'".charCodeAt(0),doubleQuote='"'.charCodeAt(0),backslash="\\".charCodeAt(0),slash="/".charCodeAt(0),comma=",".charCodeAt(0),colon=":".charCodeAt(0),star="*".charCodeAt(0),uLower="u".charCodeAt(0),uUpper="U".charCodeAt(0),plus="+".charCodeAt(0),isUnicodeRange=/^[a-f0-9?-]+$/i;module.exports=function(e){for(var o,s,n,d,t,c,r,l,a,u=[],h=e,i=0,p=h.charCodeAt(i),f=h.length,x=[{nodes:u}],A=0,C="",I="",g="";i<f;)if(p<=32){o=i;do{o+=1,p=h.charCodeAt(o)}while(p<=32);d=h.slice(i,o),n=u[u.length-1],p===closeParentheses&&A?g=d:n&&"div"===n.type?(n.after=d,n.sourceEndIndex+=d.length):p===comma||p===colon||p===slash&&h.charCodeAt(o+1)!==star&&(!a||(a&&a.type,0))?I=d:u.push({type:"space",sourceIndex:i,sourceEndIndex:o,value:d}),i=o}else if(p===singleQuote||p===doubleQuote){o=i,d={type:"string",sourceIndex:i,quote:s=p===singleQuote?"'":'"'};do{if(t=!1,~(o=h.indexOf(s,o+1)))for(c=o;h.charCodeAt(c-1)===backslash;)c-=1,t=!t;else o=(h+=s).length-1,d.unclosed=!0}while(t);d.value=h.slice(i+1,o),d.sourceEndIndex=d.unclosed?o:o+1,u.push(d),i=o+1,p=h.charCodeAt(i)}else if(p===slash&&h.charCodeAt(i+1)===star)d={type:"comment",sourceIndex:i,sourceEndIndex:(o=h.indexOf("*/",i))+2},-1===o&&(d.unclosed=!0,o=h.length,d.sourceEndIndex=o),d.value=h.slice(i+2,o),u.push(d),i=o+2,p=h.charCodeAt(i);else if(p!==slash&&p!==star||!a||"function"!==a.type)if(p===slash||p===comma||p===colon)d=h[i],u.push({type:"div",sourceIndex:i-I.length,sourceEndIndex:i+d.length,value:d,before:I,after:""}),I="",i+=1,p=h.charCodeAt(i);else if(openParentheses===p){o=i;do{o+=1,p=h.charCodeAt(o)}while(p<=32);if(l=i,d={type:"function",sourceIndex:i-C.length,value:C,before:h.slice(l+1,o)},i=o,"url"===C&&p!==singleQuote&&p!==doubleQuote){o-=1;do{if(t=!1,~(o=h.indexOf(")",o+1)))for(c=o;h.charCodeAt(c-1)===backslash;)c-=1,t=!t;else o=(h+=")").length-1,d.unclosed=!0}while(t);r=o;do{r-=1,p=h.charCodeAt(r)}while(p<=32);l<r?(d.nodes=i!==r+1?[{type:"word",sourceIndex:i,sourceEndIndex:r+1,value:h.slice(i,r+1)}]:[],d.unclosed&&r+1!==o?(d.after="",d.nodes.push({type:"space",sourceIndex:r+1,sourceEndIndex:o,value:h.slice(r+1,o)})):(d.after=h.slice(r+1,o),d.sourceEndIndex=o)):(d.after="",d.nodes=[]),i=o+1,d.sourceEndIndex=d.unclosed?o:i,p=h.charCodeAt(i),u.push(d)}else A+=1,d.after="",d.sourceEndIndex=i+1,u.push(d),x.push(d),u=d.nodes=[],a=d;C=""}else if(closeParentheses===p&&A)i+=1,p=h.charCodeAt(i),a.after=g,a.sourceEndIndex+=g.length,g="",A-=1,x[x.length-1].sourceEndIndex=i,x.pop(),u=(a=x[A]).nodes;else{o=i;do{p===backslash&&(o+=1),o+=1,p=h.charCodeAt(o)}while(o<f&&!(p<=32||p===singleQuote||p===doubleQuote||p===comma||p===colon||p===slash||p===openParentheses||p===star&&a&&"function"===a.type||p===slash&&"function"===a.type||p===closeParentheses&&A));d=h.slice(i,o),openParentheses===p?C=d:uLower!==d.charCodeAt(0)&&uUpper!==d.charCodeAt(0)||plus!==d.charCodeAt(1)||!isUnicodeRange.test(d.slice(2))?u.push({type:"word",sourceIndex:i,sourceEndIndex:o,value:d}):u.push({type:"unicode-range",sourceIndex:i,sourceEndIndex:o,value:d}),i=o}else d=h[i],u.push({type:"word",sourceIndex:i-I.length,sourceEndIndex:i+d.length,value:d}),i+=1,p=h.charCodeAt(i);for(i=x.length-1;i;i-=1)x[i].unclosed=!0,x[i].sourceEndIndex=h.length;return x[0].nodes};