"use strict";function _export(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{indentRecursive:function(){return indentRecursive},formatNodes:function(){return formatNodes},readFileWithRetries:function(){return readFileWithRetries},drainStdin:function(){return drainStdin},outputFile:function(){return outputFile}});const _fs=_interop_require_default(require("fs")),_path=_interop_require_default(require("path"));function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}function indentRecursive(e,r=0){e.each&&e.each((t,i)=>{t.raws.before&&t.raws.before.trim()&&!t.raws.before.includes("\n")||(t.raws.before=`\n${"rule"!==e.type&&i>0?"\n":""}${"  ".repeat(r)}`),t.raws.after=`\n${"  ".repeat(r)}`,indentRecursive(t,r+1)})}function formatNodes(e){indentRecursive(e),e.first&&(e.first.raws.before="")}async function readFileWithRetries(e,r=5){for(let t=0;t<=r;t++)try{return await _fs.default.promises.readFile(e,"utf8")}catch(e){if(t!==r&&("ENOENT"===e.code||"EBUSY"===e.code)){await new Promise(e=>setTimeout(e,10));continue}throw e}}function drainStdin(){return new Promise((e,r)=>{let t="";process.stdin.on("data",e=>{t+=e}),process.stdin.on("end",()=>e(t)),process.stdin.on("error",e=>r(e))})}async function outputFile(e,r){try{if(await _fs.default.promises.readFile(e,"utf8")===r)return}catch{}await _fs.default.promises.mkdir(_path.default.dirname(e),{recursive:!0}),await _fs.default.promises.writeFile(e,r,"utf8")}