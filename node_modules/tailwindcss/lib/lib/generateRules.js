"use strict";function _export(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{getClassNameFromSelector:function(){return getClassNameFromSelector},resolveMatches:function(){return resolveMatches},generateRules:function(){return generateRules}});const _postcss=_interop_require_default(require("postcss")),_postcssselectorparser=_interop_require_default(require("postcss-selector-parser")),_parseObjectStyles=_interop_require_default(require("../util/parseObjectStyles")),_isPlainObject=_interop_require_default(require("../util/isPlainObject")),_prefixSelector=_interop_require_default(require("../util/prefixSelector")),_pluginUtils=require("../util/pluginUtils"),_log=_interop_require_default(require("../util/log")),_sharedState=_interop_require_wildcard(require("./sharedState")),_formatVariantSelector=require("../util/formatVariantSelector"),_nameClass=require("../util/nameClass"),_dataTypes=require("../util/dataTypes"),_setupContextUtils=require("./setupContextUtils"),_isSyntacticallyValidPropertyValue=_interop_require_default(require("../util/isSyntacticallyValidPropertyValue")),_splitAtTopLevelOnly=require("../util/splitAtTopLevelOnly.js"),_featureFlags=require("../featureFlags"),_applyImportantSelector=require("../util/applyImportantSelector");function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(e){return e?r:t})(e)}function _interop_require_wildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=_getRequireWildcardCache(t);if(r&&r.has(e))return r.get(e);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var i=l?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(a,n,i):a[n]=e[n]}return a.default=e,r&&r.set(e,a),a}let classNameParser=(0,_postcssselectorparser.default)(e=>e.first.filter(({type:e})=>"class"===e).pop().value);function getClassNameFromSelector(e){return classNameParser.transformSync(e)}function*candidatePermutations(e){let t=1/0;for(;t>=0;){let r,a=!1;if(t===1/0&&e.endsWith("]")){let t=e.indexOf("[");"-"===e[t-1]?r=t-1:"/"===e[t-1]?(r=t-1,a=!0):r=-1}else t===1/0&&e.includes("/")?(r=e.lastIndexOf("/"),a=!0):r=e.lastIndexOf("-",t);if(r<0)break;let l=e.slice(0,r),n=e.slice(a?r:r+1);t=r-1,""!==l&&"/"!==n&&(yield[l,n])}}function applyPrefix(e,t){if(0===e.length||""===t.tailwindConfig.prefix)return e;for(let r of e){let[e]=r;if(e.options.respectPrefix){let e=_postcss.default.root({nodes:[r[1].clone()]}),a=r[1].raws.tailwind.classCandidate;e.walkRules(e=>{let r=a.startsWith("-");e.selector=(0,_prefixSelector.default)(t.tailwindConfig.prefix,e.selector,r)}),r[1]=e.nodes[0]}}return e}function applyImportant(e,t){if(0===e.length)return e;let r=[];function a(e){return e.parent&&"atrule"===e.parent.type&&"keyframes"===e.parent.name}for(let[l,n]of e){let e=_postcss.default.root({nodes:[n.clone()]});e.walkRules(e=>{if(a(e))return;let r=(0,_postcssselectorparser.default)().astSync(e.selector);r.each(e=>(0,_formatVariantSelector.eliminateIrrelevantSelectors)(e,t)),(0,_pluginUtils.updateAllClasses)(r,e=>e===t?`!${e}`:e),e.selector=r.toString(),e.walkDecls(e=>e.important=!0)}),r.push([{...l,important:!0},e.nodes[0]])}return r}function applyVariant(e,t,r){if(0===t.length)return t;let a={modifier:null,value:_sharedState.NONE};{let[s,...o]=(0,_splitAtTopLevelOnly.splitAtTopLevelOnly)(e,"/");if(o.length>1&&(s=s+"/"+o.slice(0,-1).join("/"),o=o.slice(-1)),o.length&&!r.variantMap.has(e)&&(e=s,a.modifier=o[0],!(0,_featureFlags.flagEnabled)(r.tailwindConfig,"generalizedModifiers")))return[]}if(e.endsWith("]")&&!e.startsWith("[")){let u=/(.)(-?)\[(.*)\]/g.exec(e);if(u){let[,c,p,f]=u;if("@"===c&&"-"===p)return[];if("@"!==c&&""===p)return[];e=e.replace(`${p}[${f}]`,""),a.value=f}}if(isArbitraryValue(e)&&!r.variantMap.has(e)){let d=r.offsets.recordVariant(e),y=(0,_dataTypes.normalize)(e.slice(1,-1)),_=(0,_splitAtTopLevelOnly.splitAtTopLevelOnly)(y,",");if(_.length>1)return[];if(!_.every(_setupContextUtils.isValidVariantFormatString))return[];let m=_.map((e,t)=>[r.offsets.applyParallelOffset(d,t),(0,_setupContextUtils.parseVariant)(e.trim())]);r.variantMap.set(e,m)}if(r.variantMap.has(e)){var l;let h=isArbitraryValue(e);var n;let g=null!==(n=null===(l=r.variantOptions.get(e))||void 0===l?void 0:l[_setupContextUtils.INTERNAL_FEATURES])&&void 0!==n?n:{},v=r.variantMap.get(e).slice(),w=[],S=!h&&!1!==g.respectPrefix;for(let[C,P]of t){if("user"===C.layer)continue;let O=_postcss.default.root({nodes:[P.clone()]});for(let[A,b,R]of v){let x=(null!=R?R:O).clone(),q=[];function M(){x.raws.neededBackup||(x.raws.neededBackup=!0,x.walkRules(e=>e.raws.originalSelector=e.selector))}function V(e){return M(),x.each(t=>{"rule"===t.type&&(t.selectors=t.selectors.map(t=>e({get className(){return getClassNameFromSelector(t)},selector:t})))}),x}let N=b({get container(){return M(),x},separator:r.tailwindConfig.separator,modifySelectors:V,wrap(e){let t=x.nodes;x.removeAll(),e.append(t),x.append(e)},format(e){q.push({format:e,respectPrefix:S})},args:a});if(Array.isArray(N)){for(let[T,F]of N.entries())v.push([r.offsets.applyParallelOffset(A,T),F,x.clone()]);continue}if("string"==typeof N&&q.push({format:N,respectPrefix:S}),null===N)continue;var i;x.raws.neededBackup&&(delete x.raws.neededBackup,x.walkRules(t=>{let a=t.raws.originalSelector;if(!a)return;if(delete t.raws.originalSelector,a===t.selector)return;let l=t.selector,n=(0,_postcssselectorparser.default)(t=>{t.walkClasses(t=>{t.value=`${e}${r.tailwindConfig.separator}${t.value}`})}).processSync(a);q.push({format:l.replace(n,"&"),respectPrefix:S}),t.selector=a})),x.nodes[0].raws.tailwind={...x.nodes[0].raws.tailwind,parentLayer:C.layer};let k=[{...C,sort:r.offsets.applyVariantOffset(C.sort,A,Object.assign(a,r.variantOptions.get(e))),collectedFormats:(null!==(i=C.collectedFormats)&&void 0!==i?i:[]).concat(q)},x.nodes[0]];w.push(k)}}return w}return[]}function parseRules(e,t,r={}){return(0,_isPlainObject.default)(e)||Array.isArray(e)?Array.isArray(e)?parseRules(e[0],t,e[1]):(t.has(e)||t.set(e,(0,_parseObjectStyles.default)(e)),[t.get(e),r]):[[e],r]}const IS_VALID_PROPERTY_NAME=/^[a-z_-]/;function isValidPropName(e){return IS_VALID_PROPERTY_NAME.test(e)}function looksLikeUri(e){if(!e.includes("://"))return!1;try{const t=new URL(e);return""!==t.scheme&&""!==t.host}catch(e){return!1}}function isParsableNode(e){let t=!0;return e.walkDecls(e=>{if(!isParsableCssValue(e.prop,e.value))return t=!1,!1}),t}function isParsableCssValue(e,t){if(looksLikeUri(`${e}:${t}`))return!1;try{return _postcss.default.parse(`a{${e}:${t}}`).toResult(),!0}catch(e){return!1}}function extractArbitraryProperty(e,t){var r;let[,a,l]=null!==(r=e.match(/^\[([a-zA-Z0-9-_]+):(\S+)\]$/))&&void 0!==r?r:[];if(void 0===l)return null;if(!isValidPropName(a))return null;if(!(0,_isSyntacticallyValidPropertyValue.default)(l))return null;let n=(0,_dataTypes.normalize)(l,{property:a});return isParsableCssValue(a,n)?[[{sort:t.offsets.arbitraryProperty(e),layer:"utilities",options:{respectImportant:!0}},()=>({[(0,_nameClass.asClass)(e)]:{[a]:n}})]]:null}function*resolveMatchedPlugins(e,t){t.candidateRuleMap.has(e)&&(yield[t.candidateRuleMap.get(e),"DEFAULT"]),yield*function*(e){null!==e&&(yield[e,"DEFAULT"])}(extractArbitraryProperty(e,t));let r=e,a=!1;const l=t.tailwindConfig.prefix,n=l.length,i=r.startsWith(l)||r.startsWith(`-${l}`);"-"===r[n]&&i&&(a=!0,r=l+r.slice(n+1)),a&&t.candidateRuleMap.has(r)&&(yield[t.candidateRuleMap.get(r),"-DEFAULT"]);for(let[e,l]of candidatePermutations(r))t.candidateRuleMap.has(e)&&(yield[t.candidateRuleMap.get(e),a?`-${l}`:l])}function splitWithSeparator(e,t){return e===_sharedState.NOT_ON_DEMAND?[_sharedState.NOT_ON_DEMAND]:(0,_splitAtTopLevelOnly.splitAtTopLevelOnly)(e,t)}function*recordCandidates(e,t){for(const l of e){var r,a;l[1].raws.tailwind={...l[1].raws.tailwind,classCandidate:t,preserveSource:null!==(a=null===(r=l[0].options)||void 0===r?void 0:r.preserveSource)&&void 0!==a&&a},yield l}}function*resolveMatches(e,t){let r=t.tailwindConfig.separator,[a,...l]=splitWithSeparator(e,r).reverse(),n=!1;a.startsWith("!")&&(n=!0,a=a.slice(1));for(let p of resolveMatchedPlugins(a,t)){let f=[],d=new Map,[y,_]=p,m=1===y.length;for(let[h,g]of y){let v=[];if("function"==typeof g)for(let w of[].concat(g(_,{isOnlyPlugin:m}))){let[S,C]=parseRules(w,t.postCssNodeCache);for(let P of S)v.push([{...h,options:{...h.options,...C}},P])}else if("DEFAULT"===_||"-DEFAULT"===_){let O=g,[A,b]=parseRules(O,t.postCssNodeCache);for(let R of A)v.push([{...h,options:{...h.options,...b}},R])}if(v.length>0){var i,s,o;let x=Array.from((0,_pluginUtils.getMatchingTypes)(null!==(s=null===(i=h.options)||void 0===i?void 0:i.types)&&void 0!==s?s:[],_,null!==(o=h.options)&&void 0!==o?o:{},t.tailwindConfig)).map(([e,t])=>t);x.length>0&&d.set(v,x),f.push(v)}}if(isArbitraryValue(_)){if(f.length>1){let[q,M]=f.reduce((e,t)=>(t.some(([{options:e}])=>e.types.some(({type:e})=>"any"===e))?e[0].push(t):e[1].push(t),e),[[],[]]);function V(e){return 1===e.length?e[0]:e.find(e=>{let t=d.get(e);return e.some(([{options:e},r])=>!!isParsableNode(r)&&e.types.some(({type:e,preferOnConflict:r})=>t.includes(e)&&r))})}var u;let N=null!==(u=V(M))&&void 0!==u?u:V(q);if(!N){var c;let k=f.map(e=>new Set([...null!==(c=d.get(e))&&void 0!==c?c:[]]));for(let F of k)for(let L of F){let j=!1;for(let I of k)F!==I&&I.has(L)&&(I.delete(L),j=!0);j&&F.delete(L)}let T=[];for(let[U,$]of k.entries())for(let W of $){let D=f[U].map(([,e])=>e).flat().map(e=>e.toString().split("\n").slice(1,-1).map(e=>e.trim()).map(e=>`      ${e}`).join("\n")).join("\n\n");T.push(`  Use \`${e.replace("[",`[${W}:`)}\` for \`${D.trim()}\``);break}_log.default.warn([`The class \`${e}\` is ambiguous and matches multiple utilities.`,...T,`If this is content and not a class, replace it with \`${e.replace("[","&lsqb;").replace("]","&rsqb;")}\` to silence this warning.`]);continue}f=[N]}f=f.map(e=>e.filter(e=>isParsableNode(e[1])))}f=f.flat(),f=Array.from(recordCandidates(f,a)),f=applyPrefix(f,t),n&&(f=applyImportant(f,a));for(let E of l)f=applyVariant(E,f,t);for(let z of f)z[1].raws.tailwind={...z[1].raws.tailwind,candidate:e},z=applyFinalFormat(z,{context:t,candidate:e}),null!==z&&(yield z)}}function applyFinalFormat(e,{context:t,candidate:r}){if(!e[0].collectedFormats)return e;let a,l=!0;try{a=(0,_formatVariantSelector.formatVariantSelector)(e[0].collectedFormats,{context:t,candidate:r})}catch{return null}let n=_postcss.default.root({nodes:[e[1].clone()]});return n.walkRules(e=>{if(!inKeyframes(e))try{let l=(0,_formatVariantSelector.finalizeSelector)(e.selector,a,{candidate:r,context:t});if(null===l)return void e.remove();e.selector=l}catch{return l=!1,!1}}),l?0===n.nodes.length?null:(e[1]=n.nodes[0],e):null}function inKeyframes(e){return e.parent&&"atrule"===e.parent.type&&"keyframes"===e.parent.name}function getImportantStrategy(e){return!0===e?e=>{inKeyframes(e)||e.walkDecls(e=>{"rule"!==e.parent.type||inKeyframes(e.parent)||(e.important=!0)})}:"string"==typeof e?t=>{inKeyframes(t)||(t.selectors=t.selectors.map(t=>(0,_applyImportantSelector.applyImportantSelector)(t,e)))}:void 0}function generateRules(e,t,r=!1){let a=[],l=getImportantStrategy(t.tailwindConfig.important);for(let i of e){if(t.notClassCache.has(i))continue;if(t.candidateRuleCache.has(i)){a=a.concat(Array.from(t.candidateRuleCache.get(i)));continue}let e=Array.from(resolveMatches(i,t));if(0===e.length){t.notClassCache.add(i);continue}var n;t.classCache.set(i,e);let s=null!==(n=t.candidateRuleCache.get(i))&&void 0!==n?n:new Set;t.candidateRuleCache.set(i,s);for(const n of e){let[{sort:e,options:i},o]=n;if(i.respectImportant&&l){let e=_postcss.default.root({nodes:[o.clone()]});e.walkRules(l),o=e.nodes[0]}let u=[e,r?o.clone():o];s.add(u),t.ruleCache.add(u),a.push(u)}}return a}function isArbitraryValue(e){return e.startsWith("[")&&e.endsWith("]")}