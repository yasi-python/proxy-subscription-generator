"use strict";function _export(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{formatVariantSelector:function(){return formatVariantSelector},eliminateIrrelevantSelectors:function(){return eliminateIrrelevantSelectors},finalizeSelector:function(){return finalizeSelector},handleMergePseudo:function(){return handleMergePseudo}});const _postcssselectorparser=_interop_require_default(require("postcss-selector-parser")),_unesc=_interop_require_default(require("postcss-selector-parser/dist/util/unesc")),_escapeClassName=_interop_require_default(require("../util/escapeClassName")),_prefixSelector=_interop_require_default(require("../util/prefixSelector")),_pseudoElements=require("./pseudoElements"),_splitAtTopLevelOnly=require("./splitAtTopLevelOnly");function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}let MERGE=":merge";function formatVariantSelector(e,{context:t,candidate:r}){var s;let l=null!==(s=null==t?void 0:t.tailwindConfig.prefix)&&void 0!==s?s:"",o=e.map(e=>{let t=(0,_postcssselectorparser.default)().astSync(e.format);return{...e,ast:e.respectPrefix?(0,_prefixSelector.default)(l,t):t}}),n=_postcssselectorparser.default.root({nodes:[_postcssselectorparser.default.selector({nodes:[_postcssselectorparser.default.className({value:(0,_escapeClassName.default)(r)})]})]});for(let{ast:e}of o)[n,e]=handleMergePseudo(n,e),e.walkNesting(e=>e.replaceWith(...n.nodes[0].nodes)),n=e;return n}function simpleSelectorForNode(e){let t=[];for(;e.prev()&&"combinator"!==e.prev().type;)e=e.prev();for(;e&&"combinator"!==e.type;)t.push(e),e=e.next();return t}function resortSelector(e){return e.sort((t,r)=>"tag"===t.type&&"class"===r.type?-1:"class"===t.type&&"tag"===r.type?1:"class"===t.type&&"pseudo"===r.type&&r.value.startsWith("::")?-1:"pseudo"===t.type&&t.value.startsWith("::")&&"class"===r.type?1:e.index(t)-e.index(r)),e}function eliminateIrrelevantSelectors(e,t){let r=!1;e.walk(e=>{if("class"===e.type&&e.value===t)return r=!0,!1}),r||e.remove()}function finalizeSelector(e,t,{context:r,candidate:s,base:l}){var o,n;let a=null!==(n=null==r||null===(o=r.tailwindConfig)||void 0===o?void 0:o.separator)&&void 0!==n?n:":";l=null!=l?l:(0,_splitAtTopLevelOnly.splitAtTopLevelOnly)(s,a).pop();let i=(0,_postcssselectorparser.default)().astSync(e);if(i.walkClasses(e=>{e.raws&&e.value.includes(l)&&(e.raws.value=(0,_escapeClassName.default)((0,_unesc.default)(e.raws.value)))}),i.each(e=>eliminateIrrelevantSelectors(e,l)),0===i.length)return null;let u=Array.isArray(t)?formatVariantSelector(t,{context:r,candidate:s}):t;if(null===u)return i.toString();let c=_postcssselectorparser.default.comment({value:"/*__simple__*/"}),p=_postcssselectorparser.default.comment({value:"/*__simple__*/"});return i.walkClasses(e=>{if(e.value!==l)return;let t=e.parent,r=u.nodes[0].nodes;if(1===t.nodes.length)return void e.replaceWith(...r);let s=simpleSelectorForNode(e);t.insertBefore(s[0],c),t.insertAfter(s[s.length-1],p);for(let e of r)t.insertBefore(s[0],e.clone());e.remove(),s=simpleSelectorForNode(c);let o=t.index(c);t.nodes.splice(o,s.length,...resortSelector(_postcssselectorparser.default.selector({nodes:s})).nodes),c.remove(),p.remove()}),i.walkPseudos(e=>{e.value===MERGE&&e.replaceWith(e.nodes)}),i.each(e=>(0,_pseudoElements.movePseudos)(e)),i.toString()}function handleMergePseudo(e,t){let r=[];return e.walkPseudos(e=>{e.value===MERGE&&r.push({pseudo:e,value:e.nodes[0].toString()})}),t.walkPseudos(e=>{if(e.value!==MERGE)return;let t=e.nodes[0].toString(),s=r.find(e=>e.value===t);if(!s)return;let l=[],o=e.next();for(;o&&"combinator"!==o.type;)l.push(o),o=o.next();let n=o;s.pseudo.parent.insertAfter(s.pseudo,_postcssselectorparser.default.selector({nodes:l.map(e=>e.clone())})),e.remove(),l.forEach(e=>e.remove()),n&&"combinator"===n.type&&n.remove()}),[e,t]}