"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const utils=require("../../utils"),partial_1=require("../matchers/partial");class DeepFilter{constructor(t,e){this._settings=t,this._micromatchOptions=e}getFilter(t,e,i){const s=this._getMatcher(e),r=this._getNegativePatternsRe(i);return e=>this._filter(t,e,s,r)}_getMatcher(t){return new partial_1.default(t,this._settings,this._micromatchOptions)}_getNegativePatternsRe(t){const e=t.filter(utils.pattern.isAffectDepthOfReadingPattern);return utils.pattern.convertPatternsToRe(e,this._micromatchOptions)}_filter(t,e,i,s){if(this._isSkippedByDeep(t,e.path))return!1;if(this._isSkippedSymbolicLink(e))return!1;const r=utils.path.removeLeadingDotSegment(e.path);return!this._isSkippedByPositivePatterns(r,i)&&this._isSkippedByNegativePatterns(r,s)}_isSkippedByDeep(t,e){return this._settings.deep!==1/0&&this._getEntryLevel(t,e)>=this._settings.deep}_getEntryLevel(t,e){const i=e.split("/").length;return""===t?i:i-t.split("/").length}_isSkippedSymbolicLink(t){return!this._settings.followSymbolicLinks&&t.dirent.isSymbolicLink()}_isSkippedByPositivePatterns(t,e){return!this._settings.baseNameMatch&&!e.match(t)}_isSkippedByNegativePatterns(t,e){return!utils.pattern.matchAny(t,e)}}exports.default=DeepFilter;