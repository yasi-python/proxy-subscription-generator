"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.convertPatternGroupToTask=exports.convertPatternGroupsToTasks=exports.groupPatternsByBaseDirectory=exports.getNegativePatternsAsPositive=exports.getPositivePatterns=exports.convertPatternsToTasks=exports.generate=void 0;const utils=require("../utils");function generate(t,e){const r=processPatterns(t,e),s=processPatterns(e.ignore,e),n=getPositivePatterns(r),o=getNegativePatternsAsPositive(r,s),a=n.filter(t=>utils.pattern.isStaticPattern(t,e)),i=n.filter(t=>utils.pattern.isDynamicPattern(t,e)),p=convertPatternsToTasks(a,o,!1),c=convertPatternsToTasks(i,o,!0);return p.concat(c)}function processPatterns(t,e){let r=t;return e.braceExpansion&&(r=utils.pattern.expandPatternsWithBraceExpansion(r)),e.baseNameMatch&&(r=r.map(t=>t.includes("/")?t:`**/${t}`)),r.map(t=>utils.pattern.removeDuplicateSlashes(t))}function convertPatternsToTasks(t,e,r){const s=[],n=utils.pattern.getPatternsOutsideCurrentDirectory(t),o=utils.pattern.getPatternsInsideCurrentDirectory(t),a=groupPatternsByBaseDirectory(n),i=groupPatternsByBaseDirectory(o);return s.push(...convertPatternGroupsToTasks(a,e,r)),"."in i?s.push(convertPatternGroupToTask(".",o,e,r)):s.push(...convertPatternGroupsToTasks(i,e,r)),s}function getPositivePatterns(t){return utils.pattern.getPositivePatterns(t)}function getNegativePatternsAsPositive(t,e){return utils.pattern.getNegativePatterns(t).concat(e).map(utils.pattern.convertToPositivePattern)}function groupPatternsByBaseDirectory(t){return t.reduce((t,e)=>{const r=utils.pattern.getBaseDirectory(e);return r in t?t[r].push(e):t[r]=[e],t},{})}function convertPatternGroupsToTasks(t,e,r){return Object.keys(t).map(s=>convertPatternGroupToTask(s,t[s],e,r))}function convertPatternGroupToTask(t,e,r,s){return{dynamic:s,positive:e,negative:r,base:t,patterns:[].concat(e,r.map(utils.pattern.convertToNegativePattern))}}exports.generate=generate,exports.convertPatternsToTasks=convertPatternsToTasks,exports.getPositivePatterns=getPositivePatterns,exports.getNegativePatternsAsPositive=getNegativePatternsAsPositive,exports.groupPatternsByBaseDirectory=groupPatternsByBaseDirectory,exports.convertPatternGroupsToTasks=convertPatternGroupsToTasks,exports.convertPatternGroupToTask=convertPatternGroupToTask;