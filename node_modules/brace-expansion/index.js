var balanced=require("balanced-match");module.exports=expandTop;var escSlash="\0SLASH"+Math.random()+"\0",escOpen="\0OPEN"+Math.random()+"\0",escClose="\0CLOSE"+Math.random()+"\0",escComma="\0COMMA"+Math.random()+"\0",escPeriod="\0PERIOD"+Math.random()+"\0";function numeric(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function escapeBraces(e){return e.split("\\\\").join(escSlash).split("\\{").join(escOpen).split("\\}").join(escClose).split("\\,").join(escComma).split("\\.").join(escPeriod)}function unescapeBraces(e){return e.split(escSlash).join("\\").split(escOpen).join("{").split(escClose).join("}").split(escComma).join(",").split(escPeriod).join(".")}function parseCommaParts(e){if(!e)return[""];var r=[],n=balanced("{","}",e);if(!n)return e.split(",");var t=n.pre,a=n.body,s=n.post,o=t.split(",");o[o.length-1]+="{"+a+"}";var i=parseCommaParts(s);return s.length&&(o[o.length-1]+=i.shift(),o.push.apply(o,i)),r.push.apply(r,o),r}function expandTop(e){return e?("{}"===e.substr(0,2)&&(e="\\{\\}"+e.substr(2)),expand(escapeBraces(e),!0).map(unescapeBraces)):[]}function embrace(e){return"{"+e+"}"}function isPadded(e){return/^-?0\d/.test(e)}function lte(e,r){return e<=r}function gte(e,r){return e>=r}function expand(e,r){var n=[],t=balanced("{","}",e);if(!t)return[e];var a=t.pre,s=t.post.length?expand(t.post,!1):[""];if(/\$$/.test(t.pre))for(var o=0;o<s.length;o++){var i=a+"{"+t.body+"}"+s[o];n.push(i)}else{var p,c,l=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(t.body),d=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(t.body),u=l||d,h=t.body.indexOf(",")>=0;if(!u&&!h)return t.post.match(/,(?!,).*\}/)?expand(e=t.pre+"{"+t.body+escClose+t.post):[e];if(u)p=t.body.split(/\.\./);else if(1===(p=parseCommaParts(t.body)).length&&1===(p=expand(p[0],!1).map(embrace)).length)return s.map(function(e){return t.pre+p[0]+e});if(u){var m=numeric(p[0]),f=numeric(p[1]),g=Math.max(p[0].length,p[1].length),b=3==p.length?Math.abs(numeric(p[2])):1,v=lte;f<m&&(b*=-1,v=gte);var C=p.some(isPadded);c=[];for(var y=m;v(y,f);y+=b){var j;if(d)"\\"===(j=String.fromCharCode(y))&&(j="");else if(j=String(y),C){var x=g-j.length;if(x>0){var P=new Array(x+1).join("0");j=y<0?"-"+P+j.slice(1):P+j}}c.push(j)}}else{c=[];for(var M=0;M<p.length;M++)c.push.apply(c,expand(p[M],!1))}for(M=0;M<c.length;M++)for(o=0;o<s.length;o++)i=a+c[M]+s[o],(!r||u||i)&&n.push(i)}return n}