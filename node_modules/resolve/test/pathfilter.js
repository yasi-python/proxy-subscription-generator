var path=require("path"),test=require("tape"),resolve=require("../"),resolverDir=path.join(__dirname,"/pathfilter/deep_ref"),pathFilterFactory=function(e){return function(r,o,l){return e.equal(r.version,"1.2.3"),e.equal(o,path.join(resolverDir,"node_modules/deep/ref")),e.equal(l,"ref"),"alt"}};test("#62: deep module references and the pathFilter",function(e){e.test("deep/ref.js",function(e){e.plan(3),resolve("deep/ref",{basedir:resolverDir},function(r,o,l){r&&e.fail(r),e.equal(l.version,"1.2.3"),e.equal(o,path.join(resolverDir,"node_modules/deep/ref.js"))});var r=resolve.sync("deep/ref",{basedir:resolverDir});e.equal(r,path.join(resolverDir,"node_modules/deep/ref.js"))}),e.test("deep/deeper/ref",function(r){r.plan(4),resolve("deep/deeper/ref",{basedir:resolverDir},function(o,l,i){o&&e.fail(o),r.notEqual(i,void 0),r.equal(i.version,"1.2.3"),r.equal(l,path.join(resolverDir,"node_modules/deep/deeper/ref.js"))});var o=resolve.sync("deep/deeper/ref",{basedir:resolverDir});r.equal(o,path.join(resolverDir,"node_modules/deep/deeper/ref.js"))}),e.test("deep/ref alt",function(e){e.plan(8);var r=pathFilterFactory(e),o=resolve.sync("deep/ref",{basedir:resolverDir,pathFilter:r});e.equal(o,path.join(resolverDir,"node_modules/deep/alt.js")),resolve("deep/ref",{basedir:resolverDir,pathFilter:r},function(r,o,l){r&&e.fail(r),e.equal(o,path.join(resolverDir,"node_modules/deep/alt.js")),e.end()})}),e.end()});