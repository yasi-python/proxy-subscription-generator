"use strict";const align={right:alignRight,center:alignCenter},top=0,right=1,bottom=2,left=3;export class UI{constructor(t){var i;this.width=t.width,this.wrap=null===(i=t.wrap)||void 0===i||i,this.rows=[]}span(...t){this.div(...t).span=!0}resetOutput(){this.rows=[]}div(...t){if(0===t.length&&this.div(""),this.wrap&&this.shouldApplyLayoutDSL(...t)&&"string"==typeof t[0])return this.applyLayoutDSL(t[0]);const i=t.map(t=>"string"==typeof t?this.colFromString(t):t);return this.rows.push(i),i}shouldApplyLayoutDSL(...t){return 1===t.length&&"string"==typeof t[0]&&/[\t\n]/.test(t[0])}applyLayoutDSL(t){const i=t.split("\n").map(t=>t.split("\t"));let n=0;return i.forEach(t=>{t.length>1&&mixin.stringWidth(t[0])>n&&(n=Math.min(Math.floor(.5*this.width),mixin.stringWidth(t[0])))}),i.forEach(t=>{this.div(...t.map((i,r)=>({text:i.trim(),padding:this.measurePadding(i),width:0===r&&t.length>1?n:void 0})))}),this.rows[this.rows.length-1]}colFromString(t){return{text:t,padding:this.measurePadding(t)}}measurePadding(t){const i=mixin.stripAnsi(t);return[0,i.match(/\s*$/)[0].length,0,i.match(/^\s*/)[0].length]}toString(){const t=[];return this.rows.forEach(i=>{this.rowToString(i,t)}),t.filter(t=>!t.hidden).map(t=>t.text).join("\n")}rowToString(t,i){return this.rasterize(t).forEach((n,r)=>{let e="";n.forEach((n,s)=>{const{width:d}=t[s],h=this.negatePadding(t[s]);let a=n;if(h>mixin.stringWidth(n)&&(a+=" ".repeat(h-mixin.stringWidth(n))),t[s].align&&"left"!==t[s].align&&this.wrap){if(a=(0,align[t[s].align])(a,h),mixin.stringWidth(a)<h){a+=" ".repeat((d||0)-mixin.stringWidth(a)-1)}}const o=t[s].padding||[0,0,0,0];o[3]&&(e+=" ".repeat(o[3])),e+=addBorder(t[s],a,"| "),e+=a,e+=addBorder(t[s],a," |"),o[1]&&(e+=" ".repeat(o[1])),0===r&&i.length>0&&(e=this.renderInline(e,i[i.length-1]))}),i.push({text:e.replace(/ +$/,""),span:t.span})}),i}renderInline(t,i){const n=t.match(/^ */),r=n?n[0].length:0,e=i.text,s=mixin.stringWidth(e.trimEnd());return i.span?this.wrap?r<s?t:(i.hidden=!0,e.trimEnd()+" ".repeat(r-s)+t.trimStart()):(i.hidden=!0,e+t):t}rasterize(t){const i=[],n=this.columnWidths(t);let r;return t.forEach((t,e)=>{t.width=n[e],r=this.wrap?mixin.wrap(t.text,this.negatePadding(t),{hard:!0}).split("\n"):t.text.split("\n"),t.border&&(r.unshift("."+"-".repeat(this.negatePadding(t)+2)+"."),r.push("'"+"-".repeat(this.negatePadding(t)+2)+"'")),t.padding&&(r.unshift(...new Array(t.padding[0]||0).fill("")),r.push(...new Array(t.padding[2]||0).fill(""))),r.forEach((t,n)=>{i[n]||i.push([]);const r=i[n];for(let t=0;t<e;t++)void 0===r[t]&&r.push("");r.push(t)})}),i}negatePadding(t){let i=t.width||0;return t.padding&&(i-=(t.padding[3]||0)+(t.padding[1]||0)),t.border&&(i-=4),i}columnWidths(t){if(!this.wrap)return t.map(t=>t.width||mixin.stringWidth(t.text));let i=t.length,n=this.width;const r=t.map(t=>{if(t.width)return i--,n-=t.width,t.width}),e=i?Math.floor(n/i):0;return r.map((i,n)=>void 0===i?Math.max(e,_minWidth(t[n])):i)}}function addBorder(t,i,n){return t.border?/[.']-+[.']/.test(i)?"":0!==i.trim().length?n:"  ":""}function _minWidth(t){const i=t.padding||[],n=1+(i[3]||0)+(i[1]||0);return t.border?n+4:n}function getWindowWidth(){return"object"==typeof process&&process.stdout&&process.stdout.columns?process.stdout.columns:80}function alignRight(t,i){t=t.trim();const n=mixin.stringWidth(t);return n<i?" ".repeat(i-n)+t:t}function alignCenter(t,i){t=t.trim();const n=mixin.stringWidth(t);return n>=i?t:" ".repeat(i-n>>1)+t}let mixin;export function cliui(t,i){return mixin=i,new UI({width:(null==t?void 0:t.width)||getWindowWidth(),wrap:null==t?void 0:t.wrap})}