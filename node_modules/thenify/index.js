var Promise=require("any-promise"),assert=require("assert");function thenify(r,e){return assert("function"==typeof r),createWrapper(r,e)}function createCallback(r,e,t){return void 0===t&&(t=!0),function(n,a){if(n)return e(n);var i=arguments.length;if(i<=2||!t)return r(a);if(Array.isArray(t)){for(var u={},f=1;f<i;f++)u[t[f-1]]=arguments[f];return r(u)}for(u=new Array(i-1),f=1;f<i;++f)u[f-1]=arguments[f];r(u)}}function createWrapper(r,e){e=e||{};var t=r.name;t=(t||"").replace(/\s|bound(?!$)/g,"");var n=function(){var t=this,n=arguments.length;if(e.withCallback&&"function"===typeof arguments[n-1])return r.apply(t,arguments);for(var a=new Array(n+1),i=0;i<n;++i)a[i]=arguments[i];var u=i;return new Promise(function(n,i){a[u]=createCallback(n,i,e.multiArgs),r.apply(t,a)})};return Object.defineProperty(n,"name",{value:t}),n}module.exports=thenify,thenify.withCallback=function(r,e){return assert("function"==typeof r),(e=e||{}).withCallback=!0,createWrapper(r,e)};