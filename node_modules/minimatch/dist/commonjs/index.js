"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.unescape=exports.escape=exports.AST=exports.Minimatch=exports.match=exports.makeRe=exports.braceExpand=exports.defaults=exports.filter=exports.GLOBSTAR=exports.sep=exports.minimatch=void 0;const brace_expansion_1=__importDefault(require("brace-expansion")),assert_valid_pattern_js_1=require("./assert-valid-pattern.js"),ast_js_1=require("./ast.js"),escape_js_1=require("./escape.js"),unescape_js_1=require("./unescape.js"),minimatch=(t,e,s={})=>((0,assert_valid_pattern_js_1.assertValidPattern)(e),!(!s.nocomment&&"#"===e.charAt(0))&&new Minimatch(e,s).match(t));exports.minimatch=minimatch;const starDotExtRE=/^\*+([^+@!?\*\[\(]*)$/,starDotExtTest=t=>e=>!e.startsWith(".")&&e.endsWith(t),starDotExtTestDot=t=>e=>e.endsWith(t),starDotExtTestNocase=t=>(t=t.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(t)),starDotExtTestNocaseDot=t=>(t=t.toLowerCase(),e=>e.toLowerCase().endsWith(t)),starDotStarRE=/^\*+\.\*+$/,starDotStarTest=t=>!t.startsWith(".")&&t.includes("."),starDotStarTestDot=t=>"."!==t&&".."!==t&&t.includes("."),dotStarRE=/^\.\*+$/,dotStarTest=t=>"."!==t&&".."!==t&&t.startsWith("."),starRE=/^\*+$/,starTest=t=>0!==t.length&&!t.startsWith("."),starTestDot=t=>0!==t.length&&"."!==t&&".."!==t,qmarksRE=/^\?+([^+@!?\*\[\(]*)?$/,qmarksTestNocase=([t,e=""])=>{const s=qmarksTestNoExt([t]);return e?(e=e.toLowerCase(),t=>s(t)&&t.toLowerCase().endsWith(e)):s},qmarksTestNocaseDot=([t,e=""])=>{const s=qmarksTestNoExtDot([t]);return e?(e=e.toLowerCase(),t=>s(t)&&t.toLowerCase().endsWith(e)):s},qmarksTestDot=([t,e=""])=>{const s=qmarksTestNoExtDot([t]);return e?t=>s(t)&&t.endsWith(e):s},qmarksTest=([t,e=""])=>{const s=qmarksTestNoExt([t]);return e?t=>s(t)&&t.endsWith(e):s},qmarksTestNoExt=([t])=>{const e=t.length;return t=>t.length===e&&!t.startsWith(".")},qmarksTestNoExtDot=([t])=>{const e=t.length;return t=>t.length===e&&"."!==t&&".."!==t},defaultPlatform="object"==typeof process&&process?"object"==typeof process.env&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",path={win32:{sep:"\\"},posix:{sep:"/"}};exports.sep="win32"===defaultPlatform?path.win32.sep:path.posix.sep,exports.minimatch.sep=exports.sep,exports.GLOBSTAR=Symbol("globstar **"),exports.minimatch.GLOBSTAR=exports.GLOBSTAR;const qmark="[^/]",star="[^/]*?",twoStarDot="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",twoStarNoDot="(?:(?!(?:\\/|^)\\.).)*?",filter=(t,e={})=>s=>(0,exports.minimatch)(s,t,e);exports.filter=filter,exports.minimatch.filter=exports.filter;const ext=(t,e={})=>Object.assign({},t,e),defaults=t=>{if(!t||"object"!=typeof t||!Object.keys(t).length)return exports.minimatch;const e=exports.minimatch;return Object.assign((s,r,i={})=>e(s,r,ext(t,i)),{Minimatch:class extends e.Minimatch{constructor(e,s={}){super(e,ext(t,s))}static defaults(s){return e.defaults(ext(t,s)).Minimatch}},AST:class extends e.AST{constructor(e,s,r={}){super(e,s,ext(t,r))}static fromGlob(s,r={}){return e.AST.fromGlob(s,ext(t,r))}},unescape:(s,r={})=>e.unescape(s,ext(t,r)),escape:(s,r={})=>e.escape(s,ext(t,r)),filter:(s,r={})=>e.filter(s,ext(t,r)),defaults:s=>e.defaults(ext(t,s)),makeRe:(s,r={})=>e.makeRe(s,ext(t,r)),braceExpand:(s,r={})=>e.braceExpand(s,ext(t,r)),match:(s,r,i={})=>e.match(s,r,ext(t,i)),sep:e.sep,GLOBSTAR:exports.GLOBSTAR})};exports.defaults=defaults,exports.minimatch.defaults=exports.defaults;const braceExpand=(t,e={})=>((0,assert_valid_pattern_js_1.assertValidPattern)(t),e.nobrace||!/\{(?:(?!\{).)*\}/.test(t)?[t]:(0,brace_expansion_1.default)(t));exports.braceExpand=braceExpand,exports.minimatch.braceExpand=exports.braceExpand;const makeRe=(t,e={})=>new Minimatch(t,e).makeRe();exports.makeRe=makeRe,exports.minimatch.makeRe=exports.makeRe;const match=(t,e,s={})=>{const r=new Minimatch(e,s);return t=t.filter(t=>r.match(t)),r.options.nonull&&!t.length&&t.push(e),t};exports.match=match,exports.minimatch.match=exports.match;const globMagic=/[?*]|[+@!]\(.*?\)|\[|\]/,regExpEscape=t=>t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class Minimatch{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(t,e={}){(0,assert_valid_pattern_js_1.assertValidPattern)(t),e=e||{},this.options=e,this.pattern=t,this.platform=e.platform||defaultPlatform,this.isWindows="win32"===this.platform,this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||!1===e.allowWindowsEscape,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!e.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!e.nonegate,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=void 0!==e.windowsNoMagicRoot?e.windowsNoMagicRoot:!(!this.isWindows||!this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const t of this.set)for(const e of t)if("string"!=typeof e)return!0;return!1}debug(...t){}make(){const t=this.pattern,e=this.options;if(!e.nocomment&&"#"===t.charAt(0))return void(this.comment=!0);if(!t)return void(this.empty=!0);this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],e.debug&&(this.debug=(...t)=>console.error(...t)),this.debug(this.pattern,this.globSet);const s=this.globSet.map(t=>this.slashSplit(t));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let r=this.globParts.map((t,e,s)=>{if(this.isWindows&&this.windowsNoMagicRoot){const e=!(""!==t[0]||""!==t[1]||"?"!==t[2]&&globMagic.test(t[2])||globMagic.test(t[3])),s=/^[a-z]:/i.test(t[0]);if(e)return[...t.slice(0,4),...t.slice(4).map(t=>this.parse(t))];if(s)return[t[0],...t.slice(1).map(t=>this.parse(t))]}return t.map(t=>this.parse(t))});if(this.debug(this.pattern,r),this.set=r.filter(t=>-1===t.indexOf(!1)),this.isWindows)for(let t=0;t<this.set.length;t++){const e=this.set[t];""===e[0]&&""===e[1]&&"?"===this.globParts[t][2]&&"string"==typeof e[3]&&/^[a-z]:$/i.test(e[3])&&(e[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)"**"===t[e][s]&&(t[e][s]="*");const{optimizationLevel:e=1}=this.options;return e>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):t=e>=1?this.levelOneOptimize(t):this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map(t=>{let e=-1;for(;-1!==(e=t.indexOf("**",e+1));){let s=e;for(;"**"===t[s+1];)s++;s!==e&&t.splice(e,s-e)}return t})}levelOneOptimize(t){return t.map(t=>0===(t=t.reduce((t,e)=>{const s=t[t.length-1];return"**"===e&&"**"===s?t:".."===e&&s&&".."!==s&&"."!==s&&"**"!==s?(t.pop(),t):(t.push(e),t)},[])).length?[""]:t)}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let e=!1;do{if(e=!1,!this.preserveMultipleSlashes){for(let s=1;s<t.length-1;s++){const r=t[s];1===s&&""===r&&""===t[0]||"."!==r&&""!==r||(e=!0,t.splice(s,1),s--)}"."!==t[0]||2!==t.length||"."!==t[1]&&""!==t[1]||(e=!0,t.pop())}let s=0;for(;-1!==(s=t.indexOf("..",s+1));){const r=t[s-1];r&&"."!==r&&".."!==r&&"**"!==r&&(e=!0,t.splice(s-1,2),s-=2)}}while(e);return 0===t.length?[""]:t}firstPhasePreProcess(t){let e=!1;do{e=!1;for(let s of t){let r=-1;for(;-1!==(r=s.indexOf("**",r+1));){let i=r;for(;"**"===s[i+1];)i++;i>r&&s.splice(r+1,i-r);let o=s[r+1];const a=s[r+2],n=s[r+3];if(".."!==o)continue;if(!a||"."===a||".."===a||!n||"."===n||".."===n)continue;e=!0,s.splice(r,1);const p=s.slice(0);p[r]="**",t.push(p),r--}if(!this.preserveMultipleSlashes){for(let t=1;t<s.length-1;t++){const r=s[t];1===t&&""===r&&""===s[0]||"."!==r&&""!==r||(e=!0,s.splice(t,1),t--)}"."!==s[0]||2!==s.length||"."!==s[1]&&""!==s[1]||(e=!0,s.pop())}let i=0;for(;-1!==(i=s.indexOf("..",i+1));){const t=s[i-1];if(t&&"."!==t&&".."!==t&&"**"!==t){e=!0;const t=1===i&&"**"===s[i+1]?["."]:[];s.splice(i-1,2,...t),0===s.length&&s.push(""),i-=2}}}}while(e);return t}secondPhasePreProcess(t){for(let e=0;e<t.length-1;e++)for(let s=e+1;s<t.length;s++){const r=this.partsMatch(t[e],t[s],!this.preserveMultipleSlashes);if(r){t[e]=[],t[s]=r;break}}return t.filter(t=>t.length)}partsMatch(t,e,s=!1){let r=0,i=0,o=[],a="";for(;r<t.length&&i<e.length;)if(t[r]===e[i])o.push("b"===a?e[i]:t[r]),r++,i++;else if(s&&"**"===t[r]&&e[i]===t[r+1])o.push(t[r]),r++;else if(s&&"**"===e[i]&&t[r]===e[i+1])o.push(e[i]),i++;else if("*"!==t[r]||!e[i]||!this.options.dot&&e[i].startsWith(".")||"**"===e[i]){if("*"!==e[i]||!t[r]||!this.options.dot&&t[r].startsWith(".")||"**"===t[r])return!1;if("a"===a)return!1;a="b",o.push(e[i]),r++,i++}else{if("b"===a)return!1;a="a",o.push(t[r]),r++,i++}return t.length===e.length&&o}parseNegate(){if(this.nonegate)return;const t=this.pattern;let e=!1,s=0;for(let r=0;r<t.length&&"!"===t.charAt(r);r++)e=!e,s++;s&&(this.pattern=t.slice(s)),this.negate=e}matchOne(t,e,s=!1){const r=this.options;if(this.isWindows){const s="string"==typeof t[0]&&/^[a-z]:$/i.test(t[0]),r=!s&&""===t[0]&&""===t[1]&&"?"===t[2]&&/^[a-z]:$/i.test(t[3]),i="string"==typeof e[0]&&/^[a-z]:$/i.test(e[0]),o=r?3:s?0:void 0,a=!i&&""===e[0]&&""===e[1]&&"?"===e[2]&&"string"==typeof e[3]&&/^[a-z]:$/i.test(e[3])?3:i?0:void 0;if("number"==typeof o&&"number"==typeof a){const[s,r]=[t[o],e[a]];s.toLowerCase()===r.toLowerCase()&&(e[a]=s,a>o?e=e.slice(a):o>a&&(t=t.slice(o)))}}const{optimizationLevel:i=1}=this.options;i>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:e}),this.debug("matchOne",t.length,e.length);for(var o=0,a=0,n=t.length,p=e.length;o<n&&a<p;o++,a++){this.debug("matchOne loop");var h=e[a],c=t[o];if(this.debug(e,h,c),!1===h)return!1;if(h===exports.GLOBSTAR){this.debug("GLOBSTAR",[e,h,c]);var l=o,u=a+1;if(u===p){for(this.debug("** at the end");o<n;o++)if("."===t[o]||".."===t[o]||!r.dot&&"."===t[o].charAt(0))return!1;return!0}for(;l<n;){var m=t[l];if(this.debug("\nglobstar while",t,l,e,u,m),this.matchOne(t.slice(l),e.slice(u),s))return this.debug("globstar found match!",l,n,m),!0;if("."===m||".."===m||!r.dot&&"."===m.charAt(0)){this.debug("dot detected!",t,l,e,u);break}this.debug("globstar swallow a segment, and continue"),l++}return!(!s||(this.debug("\n>>> no match, partial?",t,l,e,u),l!==n))}let i;if("string"==typeof h?(i=c===h,this.debug("string match",h,c,i)):(i=h.test(c),this.debug("pattern match",h,c,i)),!i)return!1}if(o===n&&a===p)return!0;if(o===n)return s;if(a===p)return o===n-1&&""===t[o];throw new Error("wtf?")}braceExpand(){return(0,exports.braceExpand)(this.pattern,this.options)}parse(t){(0,assert_valid_pattern_js_1.assertValidPattern)(t);const e=this.options;if("**"===t)return exports.GLOBSTAR;if(""===t)return"";let s,r=null;(s=t.match(starRE))?r=e.dot?starTestDot:starTest:(s=t.match(starDotExtRE))?r=(e.nocase?e.dot?starDotExtTestNocaseDot:starDotExtTestNocase:e.dot?starDotExtTestDot:starDotExtTest)(s[1]):(s=t.match(qmarksRE))?r=(e.nocase?e.dot?qmarksTestNocaseDot:qmarksTestNocase:e.dot?qmarksTestDot:qmarksTest)(s):(s=t.match(starDotStarRE))?r=e.dot?starDotStarTestDot:starDotStarTest:(s=t.match(dotStarRE))&&(r=dotStarTest);const i=ast_js_1.AST.fromGlob(t,this.options).toMMPattern();return r&&"object"==typeof i&&Reflect.defineProperty(i,"test",{value:r}),i}makeRe(){if(this.regexp||!1===this.regexp)return this.regexp;const t=this.set;if(!t.length)return this.regexp=!1,this.regexp;const e=this.options,s=e.noglobstar?star:e.dot?twoStarDot:twoStarNoDot,r=new Set(e.nocase?["i"]:[]);let i=t.map(t=>{const e=t.map(t=>{if(t instanceof RegExp)for(const e of t.flags.split(""))r.add(e);return"string"==typeof t?regExpEscape(t):t===exports.GLOBSTAR?exports.GLOBSTAR:t._src});return e.forEach((t,r)=>{const i=e[r+1],o=e[r-1];t===exports.GLOBSTAR&&o!==exports.GLOBSTAR&&(void 0===o?void 0!==i&&i!==exports.GLOBSTAR?e[r+1]="(?:\\/|"+s+"\\/)?"+i:e[r]=s:void 0===i?e[r-1]=o+"(?:\\/|"+s+")?":i!==exports.GLOBSTAR&&(e[r-1]=o+"(?:\\/|\\/"+s+"\\/)"+i,e[r+1]=exports.GLOBSTAR))}),e.filter(t=>t!==exports.GLOBSTAR).join("/")}).join("|");const[o,a]=t.length>1?["(?:",")"]:["",""];i="^"+o+i+a+"$",this.negate&&(i="^(?!"+i+").+$");try{this.regexp=new RegExp(i,[...r].join(""))}catch(t){this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,e=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return""===t;if("/"===t&&e)return!0;const s=this.options;this.isWindows&&(t=t.split("\\").join("/"));const r=this.slashSplit(t);this.debug(this.pattern,"split",r);const i=this.set;this.debug(this.pattern,"set",i);let o=r[r.length-1];if(!o)for(let t=r.length-2;!o&&t>=0;t--)o=r[t];for(let t=0;t<i.length;t++){const a=i[t];let n=r;if(s.matchBase&&1===a.length&&(n=[o]),this.matchOne(n,a,e))return!!s.flipNegate||!this.negate}return!s.flipNegate&&this.negate}static defaults(t){return exports.minimatch.defaults(t).Minimatch}}exports.Minimatch=Minimatch;var ast_js_2=require("./ast.js");Object.defineProperty(exports,"AST",{enumerable:!0,get:function(){return ast_js_2.AST}});var escape_js_2=require("./escape.js");Object.defineProperty(exports,"escape",{enumerable:!0,get:function(){return escape_js_2.escape}});var unescape_js_2=require("./unescape.js");Object.defineProperty(exports,"unescape",{enumerable:!0,get:function(){return unescape_js_2.unescape}}),exports.minimatch.AST=ast_js_1.AST,exports.minimatch.Minimatch=Minimatch,exports.minimatch.escape=escape_js_1.escape,exports.minimatch.unescape=unescape_js_1.unescape;