"use strict";const path=require("path"),resolveCommand=require("./util/resolveCommand"),escape=require("./util/escape"),readShebang=require("./util/readShebang"),isWin="win32"===process.platform,isExecutableRegExp=/\.(?:com|exe)$/i,isCmdShimRegExp=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function detectShebang(e){e.file=resolveCommand(e);const n=e.file&&readShebang(e.file);return n?(e.args.unshift(e.file),e.command=n,resolveCommand(e)):e.file}function parseNonShell(e){if(!isWin)return e;const n=detectShebang(e),s=!isExecutableRegExp.test(n);if(e.options.forceShell||s){const s=isCmdShimRegExp.test(n);e.command=path.normalize(e.command),e.command=escape.command(e.command),e.args=e.args.map(e=>escape.argument(e,s));const a=[e.command].concat(e.args).join(" ");e.args=["/d","/s","/c",`"${a}"`],e.command=process.env.comspec||"cmd.exe",e.options.windowsVerbatimArguments=!0}return e}function parse(e,n,s){n&&!Array.isArray(n)&&(s=n,n=null);const a={command:e,args:n=n?n.slice(0):[],options:s=Object.assign({},s),file:void 0,original:{command:e,args:n}};return s.shell?a:parseNonShell(a)}module.exports=parse;