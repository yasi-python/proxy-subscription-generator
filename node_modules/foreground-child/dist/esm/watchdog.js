import{spawn}from"child_process";const watchdogCode=String.raw`
const pid = parseInt(process.argv[1], 10)
process.title = 'node (foreground-child watchdog pid=' + pid + ')'
if (!isNaN(pid)) {
  let barked = false
  // keepalive
  const interval = setInterval(() => {}, 60000)
  const bark = () => {
    clearInterval(interval)
    if (barked) return
    barked = true
    process.removeListener('SIGHUP', bark)
    setTimeout(() => {
      try {
        process.kill(pid, 'SIGKILL')
        setTimeout(() => process.exit(), 200)
      } catch (_) {}
    }, 500)
  })
  process.on('SIGHUP', bark)
}
`;export const watchdog=e=>{let t=!1;const r=spawn(process.execPath,["-e",watchdogCode,String(e.pid)],{stdio:"ignore"});return r.on("exit",()=>t=!0),e.on("exit",()=>{t||r.kill("SIGKILL")}),r};