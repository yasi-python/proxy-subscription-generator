"use strict";var __spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],p=0,u=i.length;p<u;p++,o++)n[o]=i[p];return n};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Checker=exports.createCheckers=void 0;var types_1=require("./types"),util_1=require("./util"),types_2=require("./types");Object.defineProperty(exports,"TArray",{enumerable:!0,get:function(){return types_2.TArray}}),Object.defineProperty(exports,"TEnumType",{enumerable:!0,get:function(){return types_2.TEnumType}}),Object.defineProperty(exports,"TEnumLiteral",{enumerable:!0,get:function(){return types_2.TEnumLiteral}}),Object.defineProperty(exports,"TFunc",{enumerable:!0,get:function(){return types_2.TFunc}}),Object.defineProperty(exports,"TIface",{enumerable:!0,get:function(){return types_2.TIface}}),Object.defineProperty(exports,"TLiteral",{enumerable:!0,get:function(){return types_2.TLiteral}}),Object.defineProperty(exports,"TName",{enumerable:!0,get:function(){return types_2.TName}}),Object.defineProperty(exports,"TOptional",{enumerable:!0,get:function(){return types_2.TOptional}}),Object.defineProperty(exports,"TParam",{enumerable:!0,get:function(){return types_2.TParam}}),Object.defineProperty(exports,"TParamList",{enumerable:!0,get:function(){return types_2.TParamList}}),Object.defineProperty(exports,"TProp",{enumerable:!0,get:function(){return types_2.TProp}}),Object.defineProperty(exports,"TTuple",{enumerable:!0,get:function(){return types_2.TTuple}}),Object.defineProperty(exports,"TType",{enumerable:!0,get:function(){return types_2.TType}}),Object.defineProperty(exports,"TUnion",{enumerable:!0,get:function(){return types_2.TUnion}}),Object.defineProperty(exports,"TIntersection",{enumerable:!0,get:function(){return types_2.TIntersection}}),Object.defineProperty(exports,"array",{enumerable:!0,get:function(){return types_2.array}}),Object.defineProperty(exports,"enumlit",{enumerable:!0,get:function(){return types_2.enumlit}}),Object.defineProperty(exports,"enumtype",{enumerable:!0,get:function(){return types_2.enumtype}}),Object.defineProperty(exports,"func",{enumerable:!0,get:function(){return types_2.func}}),Object.defineProperty(exports,"iface",{enumerable:!0,get:function(){return types_2.iface}}),Object.defineProperty(exports,"lit",{enumerable:!0,get:function(){return types_2.lit}}),Object.defineProperty(exports,"name",{enumerable:!0,get:function(){return types_2.name}}),Object.defineProperty(exports,"opt",{enumerable:!0,get:function(){return types_2.opt}}),Object.defineProperty(exports,"param",{enumerable:!0,get:function(){return types_2.param}}),Object.defineProperty(exports,"tuple",{enumerable:!0,get:function(){return types_2.tuple}}),Object.defineProperty(exports,"union",{enumerable:!0,get:function(){return types_2.union}}),Object.defineProperty(exports,"intersection",{enumerable:!0,get:function(){return types_2.intersection}}),Object.defineProperty(exports,"BasicType",{enumerable:!0,get:function(){return types_2.BasicType}});var util_2=require("./util");function createCheckers(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=Object.assign.apply(Object,__spreadArrays([{},types_1.basicTypes],e)),n={},o=0,i=e;o<i.length;o++)for(var p=i[o],u=0,s=Object.keys(p);u<s.length;u++){var c=s[u];n[c]=new Checker(r,p[c])}return n}Object.defineProperty(exports,"VError",{enumerable:!0,get:function(){return util_2.VError}}),exports.createCheckers=createCheckers;var Checker=function(){function e(e,t,r){if(void 0===r&&(r="value"),this.suite=e,this.ttype=t,this._path=r,this.props=new Map,t instanceof types_1.TIface)for(var n=0,o=t.props;n<o.length;n++){var i=o[n];this.props.set(i.name,i.ttype)}this.checkerPlain=this.ttype.getChecker(e,!1),this.checkerStrict=this.ttype.getChecker(e,!0)}return e.prototype.setReportedPath=function(e){this._path=e},e.prototype.check=function(e){return this._doCheck(this.checkerPlain,e)},e.prototype.test=function(e){return this.checkerPlain(e,new util_1.NoopContext)},e.prototype.validate=function(e){return this._doValidate(this.checkerPlain,e)},e.prototype.strictCheck=function(e){return this._doCheck(this.checkerStrict,e)},e.prototype.strictTest=function(e){return this.checkerStrict(e,new util_1.NoopContext)},e.prototype.strictValidate=function(e){return this._doValidate(this.checkerStrict,e)},e.prototype.getProp=function(t){var r=this.props.get(t);if(!r)throw new Error("Type has no property "+t);return new e(this.suite,r,this._path+"."+t)},e.prototype.methodArgs=function(t){var r=this._getMethod(t);return new e(this.suite,r.paramList)},e.prototype.methodResult=function(t){var r=this._getMethod(t);return new e(this.suite,r.result)},e.prototype.getArgs=function(){if(!(this.ttype instanceof types_1.TFunc))throw new Error("getArgs() applied to non-function");return new e(this.suite,this.ttype.paramList)},e.prototype.getResult=function(){if(!(this.ttype instanceof types_1.TFunc))throw new Error("getResult() applied to non-function");return new e(this.suite,this.ttype.result)},e.prototype.getType=function(){return this.ttype},e.prototype._doCheck=function(e,t){if(!e(t,new util_1.NoopContext)){var r=new util_1.DetailContext;throw e(t,r),r.getError(this._path)}},e.prototype._doValidate=function(e,t){if(e(t,new util_1.NoopContext))return null;var r=new util_1.DetailContext;return e(t,r),r.getErrorDetail(this._path)},e.prototype._getMethod=function(e){var t=this.props.get(e);if(!t)throw new Error("Type has no property "+e);if(!(t instanceof types_1.TFunc))throw new Error("Property "+e+" is not a method");return t},e}();exports.Checker=Checker;